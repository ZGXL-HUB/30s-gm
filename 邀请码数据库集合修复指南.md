# 邀请码数据库集合修复指南

## 问题描述
控制台显示错误：`database collection not exist`，这是因为云数据库中缺少 `classes` 集合，导致邀请码功能无法正常工作。

## 解决方案

### 方法一：运行修复脚本（推荐）

在微信开发者工具控制台中运行以下脚本：

```javascript
// 复制并粘贴 fix_invitation_database.js 的内容到控制台执行
```

### 方法二：手动创建集合

1. **打开云开发控制台**
   - 在微信开发者工具中点击"云开发"
   - 进入"数据库"页面

2. **创建 classes 集合**
   - 点击"新建集合"
   - 集合名称：`classes`
   - 权限设置：选择"所有用户可读，仅创建者可写"

3. **创建 class_invitations 集合**
   - 点击"新建集合"
   - 集合名称：`class_invitations`
   - 权限设置：选择"所有用户可读，仅创建者可写"

4. **创建 students 集合**
   - 点击"新建集合"
   - 集合名称：`students`
   - 权限设置：选择"所有用户可读，仅创建者可写"

### 方法三：使用现有修复脚本

运行项目中已有的修复脚本：

```javascript
// 在控制台运行
fixCloudCollections();
```

## 验证修复结果

修复完成后，可以运行以下测试：

```javascript
// 测试邀请码功能
wx.cloud.callFunction({
  name: 'manageClassInvite',
  data: {
    action: 'getInfo',
    classId: 'test-class-123',
    teacherId: 'teacher_123'
  }
}).then(res => {
  console.log('✅ 邀请码功能测试结果:', res);
}).catch(err => {
  console.error('❌ 邀请码功能测试失败:', err);
});
```

## 预期结果

修复成功后：
- ✅ 不再出现 `database collection not exist` 错误
- ✅ 邀请码生成功能正常工作
- ✅ 可以正常查看班级邀请信息

## 注意事项

1. **权限设置**：确保数据库集合的权限设置正确
2. **云开发环境**：确保云开发环境已正确初始化
3. **网络连接**：确保网络连接稳定

---

**修复完成后，邀请码功能应该能正常工作了！** 🎉
