# 上传初中模块题目到云数据库指南

## 问题说明

预览界面没有出现题目，是因为题目数据需要先上传到云数据库的 `questions` 集合中。系统从云数据库读取题目，而不是从本地JSON文件读取。

## 解决步骤

### 方法1：在微信开发者工具控制台上传（推荐）

#### 步骤1：生成JSON文件

```bash
node generate_middle_school_questions.js
```

这会生成 `middle_school_questions.json` 文件，包含105道题目。

#### 步骤2：在微信开发者工具中上传

1. **打开微信开发者工具**
   - 打开项目
   - 打开控制台（Console）

2. **复制上传脚本**
   - 打开 `upload_middle_school_questions.js` 文件
   - 复制整个文件内容
   - 粘贴到控制台并回车（这会加载上传函数）

3. **读取JSON文件内容**
   - 打开 `middle_school_questions.json` 文件
   - 复制整个JSON数组内容（从 `[` 开始到 `]` 结束）

4. **在控制台运行上传命令**
   ```javascript
   // 将JSON数据赋值给变量
   const questions = [粘贴的JSON内容];
   
   // 上传题目
   uploadQuestionsFromJSON(questions);
   ```

5. **等待上传完成**
   - 控制台会显示上传进度
   - 完成后会显示统计信息

6. **验证上传结果**
   ```javascript
   verifyUpload();
   ```

### 方法2：使用云函数上传

如果项目中有 `uploadQuestions` 云函数：

```javascript
// 在控制台运行
const questions = [粘贴的JSON内容];
uploadViaCloudFunction(questions);
```

### 方法3：通过云开发控制台上传

1. **打开云开发控制台**
   - 微信开发者工具 → 云开发 → 数据库

2. **选择 questions 集合**

3. **导入数据**
   - 点击"导入"按钮
   - 选择 `middle_school_questions.json` 文件
   - 确认导入

**注意**：如果使用控制台导入，需要确保JSON格式正确，每行一个JSON对象（JSON Lines格式）。

## 验证题目是否上传成功

### 方法1：在控制台验证

```javascript
// 验证初中模块题库题目数量
verifyUpload();
```

### 方法2：在云开发控制台查看

1. 打开云开发控制台
2. 进入数据库 → questions 集合
3. 添加查询条件：
   - `schoolLevel` = `middle`
   - `source` = `题库`
4. 查看结果数量（应该显示105条）

### 方法3：在预览界面测试

1. 进入初中模块自选20题模式
2. 选择几个语法点
3. 点击预览
4. 查看是否能正常显示题目

## 常见问题

### Q1: 上传时提示"云开发环境不可用"

**解决方案**：
- 确保已初始化云开发
- 检查 `app.js` 中是否调用了 `wx.cloud.init()`
- 确保云开发环境ID配置正确

### Q2: 上传时提示"题目已存在"

**解决方案**：
- 这是正常的，说明题目已经存在
- 脚本会自动跳过重复题目
- 如果想重新上传，可以先删除旧数据

### Q3: 上传后预览界面仍没有题目

**检查清单**：
1. ✅ 确认题目已上传到云数据库
2. ✅ 确认 `schoolLevel` 字段为 `'middle'`
3. ✅ 确认 `grammarPoint` 字段与选择的语法点名称一致
4. ✅ 确认 `type` 字段为 `'choice'` 或 `'fill_blank'`
5. ✅ 查看控制台是否有错误信息

### Q4: 如何删除旧题目重新上传

```javascript
// 在控制台运行（谨慎操作）
const db = wx.cloud.database();
db.collection('questions')
  .where({
    schoolLevel: 'middle',
    source: '题库'
  })
  .remove()
  .then(res => {
    console.log('删除成功', res);
  })
  .catch(err => {
    console.error('删除失败', err);
  });
```

## 题目字段要求

上传的题目必须包含以下字段：

- ✅ `text` - 题目文本（必填）
- ✅ `answer` - 答案（必填）
- ✅ `grammarPoint` - 三级知识点名称（必填）
- ✅ `category` - 二级知识点名称
- ✅ `type` - 题目类型：`'choice'` 或 `'fill_blank'`
- ✅ `options` - 选择题选项（数组，选择题必填）
- ✅ `schoolLevel` - 学段：`'middle'`（初中）
- ✅ `source` - 来源：`'题库'`（区分于变式题）

## 上传后的效果

上传成功后：
- ✅ 预览界面可以正常显示题目
- ✅ 自选20题模式可以按语法点筛选题目
- ✅ 题目包含完整的选项和解析
- ✅ 考频信息正确显示

## 快速检查脚本

在控制台运行以下代码，快速检查题目是否正确上传：

```javascript
// 检查特定语法点的题目
const db = wx.cloud.database();
db.collection('questions')
  .where({
    grammarPoint: '物主代词',
    schoolLevel: 'middle',
    source: '题库'
  })
  .get()
  .then(res => {
    console.log('找到题目:', res.data.length, '道');
    console.log('示例题目:', res.data[0]);
  });
```


