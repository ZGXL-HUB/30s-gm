# 云函数部署指南

## 环境信息
- **云环境ID**: `cloud1-4gyu3i1id5f4e2fa1`
- **小程序AppID**: `wx0aabac4fe3b9cca7`

## 部署步骤

### 1. 云开发初始化
✅ **已完成** - 已在 `miniprogram/config/env.js` 中配置环境ID

### 2. 部署云函数

在微信开发者工具中，按以下顺序部署云函数：

#### 核心云函数（必须部署）
1. **login** - 用户登录认证
   - 右键 `cloudfunctions/login` → 上传并部署：云端安装依赖

2. **helloCloud** - 云开发连通性测试
   - 右键 `cloudfunctions/helloCloud` → 上传并部署：云端安装依赖

3. **practiceProgress** - 练习进度管理
   - 右键 `cloudfunctions/practiceProgress` → 上传并部署：云端安装依赖

4. **manageQuestions** - 题目管理
   - 右键 `cloudfunctions/manageQuestions` → 上传并部署：云端安装依赖

5. **getQuestionsData** - 题目数据获取
   - 右键 `cloudfunctions/getQuestionsData` → 上传并部署：云端安装依赖

#### 扩展云函数（可选部署）
6. **adminAuth** - 管理员权限认证
7. **importExportQuestions** - 题目导入导出
8. **initializeQuestions** - 题目初始化
9. **feedbackManager** - 反馈管理
10. **generateExcel** - Excel生成
11. **generatePDF** - PDF生成
12. **generateWord** - Word生成

### 3. 云数据库集合设置

在云开发控制台中创建以下集合并设置权限：

#### 必需集合
- **questions** 
  - 权限：所有用户可读，仅创建者可写
  - 用途：存储题目数据

- **practice_progress**
  - 权限：仅创建者可读写
  - 用途：存储用户练习进度

- **user_progress**
  - 权限：仅创建者可读写
  - 用途：存储用户测试记录

#### 可选集合
- **feedback** - 用户反馈
- **admin_logs** - 管理员操作日志

### 4. 验证部署

#### 使用测试脚本
1. 将 `test_cloudfunctions.js` 中的代码复制到小程序的测试页面
2. 调用 `runComprehensiveTest()` 函数进行测试

#### 手动验证
1. 在小程序控制台查看云函数调用日志
2. 检查是否有错误信息
3. 测试用户登录功能
4. 测试题目数据加载

### 5. 常见问题

#### 部署失败
- 检查网络连接
- 确认云开发环境ID正确
- 检查云函数代码语法错误

#### 云函数调用失败
- 检查云函数是否部署成功
- 确认云函数名称正确
- 检查参数传递是否正确

#### 数据库权限问题
- 确认集合权限设置正确
- 检查用户登录状态
- 验证OpenID获取是否正常

## 部署完成后

1. 重启小程序
2. 清除本地缓存
3. 测试核心功能：
   - 用户登录
   - 题目加载
   - 练习进度保存
   - 错题统计

## 监控和维护

- 定期检查云函数调用日志
- 监控数据库使用量
- 关注错误率和性能指标
- 及时处理用户反馈

