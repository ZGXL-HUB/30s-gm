# 云函数部署指南

## 📋 部署步骤

### 第一步：打开云开发控制台
1. 在微信开发者工具中，点击工具栏的 **"云开发"** 按钮
2. 进入云开发控制台

### 第二步：找到云函数
1. 在云开发控制台左侧菜单中，点击 **"云函数"**
2. 找到 `parseStudentExcel` 云函数
   - 如果不存在，点击 **"新建云函数"** 创建
   - 如果已存在，点击函数名称进入编辑

### 第三步：更新云函数代码
1. 点击 **"编辑"** 按钮
2. 将 `parseStudentExcel_cloud_function.js` 文件的内容复制到 `index.js` 文件中
3. 保存文件

### 第四步：安装依赖（可选）
如果需要真正的Excel解析功能，可以安装Excel解析库：
1. 在云函数目录下运行：`npm install xlsx`
2. 或者直接在云开发控制台中添加依赖

### 第五步：部署云函数
1. 点击 **"部署"** 按钮
2. 等待部署完成
3. 查看部署日志确认成功

## 🔧 云函数配置

### 基本配置
- **函数名称**: `parseStudentExcel`
- **运行环境**: Node.js 16
- **内存配置**: 256MB（推荐）
- **超时时间**: 30秒

### 权限配置
确保云函数有以下权限：
- 云数据库读写权限
- 云存储读写权限

## 🧪 测试云函数

### 在云开发控制台测试
1. 点击云函数名称
2. 点击 **"测试"** 按钮
3. 输入测试参数：
```json
{
  "fileId": "cloud://test-file-id",
  "classId": "test-class-id",
  "teacherId": "teacher_123"
}
```

### 在小程序中测试
运行 `test_cloud_function_fix.js` 脚本进行测试

## 📝 注意事项

1. **文件大小限制**: 云函数上传的文件不能超过10MB
2. **执行时间限制**: 云函数执行时间不能超过30秒
3. **并发限制**: 注意云函数的并发执行限制
4. **错误处理**: 确保云函数有完善的错误处理机制

## 🚨 常见问题

### Q: 云函数部署失败
**A**: 检查代码语法错误，确保所有依赖都已安装

### Q: 云函数执行超时
**A**: 增加超时时间或优化代码逻辑

### Q: 数据库权限错误
**A**: 检查云函数权限配置，确保有数据库读写权限

### Q: 文件下载失败
**A**: 检查文件ID是否正确，文件是否存在

## 📞 技术支持

如果遇到问题，可以：
1. 查看云开发控制台的错误日志
2. 检查微信开发者工具的控制台输出
3. 参考微信云开发官方文档

---

**部署完成后，请运行测试脚本验证功能是否正常！**