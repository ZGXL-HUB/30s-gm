# 快速测试步骤

## 问题说明

测试脚本报错的原因：
1. **未找到教师信息** - 需要先以教师身份登录小程序
2. **module is not defined** - 已修复，是控制台环境不支持模块导出

## 解决方案

### 方案A：先登录教师账号（推荐用于完整测试）

#### 步骤1：教师登录
1. 在微信开发者工具中打开小程序
2. 点击模拟器顶部的"切换用户"或"重新编译"
3. 进入教师相关页面，例如：
   - 教师班级管理页面
   - 教师个人中心
4. 完成教师登录流程

#### 步骤2：验证登录状态
在控制台中运行：
```javascript
wx.getStorageSync('teacherInfo')
```

如果返回教师信息对象（包含_id、name等），说明登录成功。

#### 步骤3：运行完整测试
1. 复制 `test_student_join_class_fix.js` 的全部内容
2. 粘贴到控制台
3. 运行测试函数：
```javascript
testStudentJoinClassFix()
```

### 方案B：简化测试（不需要教师登录）

这个方案只测试邀请码验证和人数显示，不创建新学生。

#### 步骤1：获取邀请码
你需要先有一个有效的邀请码。有两种方式：

**方式1：如果已有班级**
在控制台查询：
```javascript
const db = wx.cloud.database();
db.collection('classes').where({
  status: 'active'
}).get().then(res => {
  if (res.data.length > 0) {
    console.log('找到班级：', res.data[0].name);
    console.log('邀请码：', res.data[0].inviteCode);
  } else {
    console.log('未找到活跃的班级');
  }
});
```

**方式2：手动创建班级**
1. 以教师身份登录小程序
2. 创建一个测试班级
3. 生成邀请码
4. 记录邀请码

#### 步骤2：运行简化测试
1. 复制 `test_invite_code_validation.js` 的全部内容
2. 粘贴到控制台
3. 运行测试（替换为你的邀请码）：
```javascript
testInviteCodeValidation("123456")
```

#### 步骤3：查看结果
测试会显示：
- ✓ 邀请码是否有效
- ✓ 班级信息（名称、教师、人数等）
- ✓ 实时统计的学生数量
- ✓ 数据是否一致

### 方案C：手动测试（最简单）

如果不想运行测试脚本，可以直接手动测试：

#### 教师端操作
1. 以教师身份登录
2. 进入班级管理
3. 创建或选择一个班级
4. 生成邀请码
5. 记录当前学生人数

#### 学生端操作
1. 切换到学生身份（或使用另一个账号）
2. 进入"加入班级"页面（`pages/student-join-class/index`）
3. 输入邀请码
4. 查看显示的班级人数（应该与教师端一致）
5. 输入姓名
6. 点击"确认加入班级"

#### 验证结果
1. 打开云开发控制台
2. 进入数据库
3. 查看 `students` 集合
4. 确认新学生记录已创建，包含：
   - openId
   - name（你输入的姓名）
   - classId
   - teacherId
   - status: 'active'

5. 查看 `classes` 集合
6. 确认 `currentStudents` 字段已增加1

## 推荐测试顺序

### 第一次测试（部署后）
1. 使用**方案B**（简化测试）验证邀请码功能
2. 使用**方案C**（手动测试）验证完整流程
3. 检查云函数日志，确认有详细的执行记录

### 后续测试
1. 使用**方案A**（完整自动化测试）

## 常见问题

### Q1: 如何获取教师账号？
**A:** 如果没有教师账号：
1. 进入教师注册页面
2. 填写教师信息（姓名、学校等）
3. 完成注册
4. 重新运行测试

### Q2: 找不到活跃的班级怎么办？
**A:** 创建一个测试班级：
```javascript
const db = wx.cloud.database();
db.collection('classes').add({
  data: {
    name: '测试班级',
    teacherId: 'your_teacher_id', // 替换为实际的教师ID
    teacherName: '测试教师',
    status: 'active',
    currentStudents: 0,
    maxStudents: 50,
    createdAt: new Date()
  }
}).then(res => {
  console.log('班级创建成功，ID:', res._id);
  // 生成邀请码
  return wx.cloud.callFunction({
    name: 'manageClassInvite',
    data: {
      action: 'generate',
      classId: res._id,
      teacherId: 'your_teacher_id',
      expireDays: 7
    }
  });
}).then(res => {
  console.log('邀请码:', res.result.data.inviteCode);
});
```

### Q3: 云函数日志在哪里查看？
**A:** 
1. 打开微信开发者工具
2. 点击"云开发"按钮
3. 选择"云函数"标签
4. 点击对应的云函数名称
5. 查看"日志"标签

### Q4: 测试后如何清理数据？
**A:** 删除测试学生：
```javascript
const db = wx.cloud.database();
db.collection('students').where({
  name: db.RegExp({
    regexp: '^测试学生',
    options: 'i'
  })
}).remove().then(res => {
  console.log('删除了', res.removed, '条记录');
});
```

## 需要帮助？

如果遇到其他问题：
1. 检查云函数是否已部署
2. 查看云函数日志中的错误信息
3. 确认云开发环境已初始化
4. 检查数据库权限设置

