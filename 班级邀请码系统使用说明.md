# 班级邀请码系统使用说明

## ⚠️ 重要说明（2025年更新）

**当前推荐使用邀请码方式管理学生加入**

为避免数据冲突和重复学生问题，我们已临时隐藏以下功能：
- ❌ 教师端"导入学生"按钮（Excel导入、手动输入）
- ❌ 教师端"添加学生"按钮
- ❌ 创建班级时的"导入学生名单"功能

**推荐流程：**
1. 教师创建班级（自动生成邀请码）
2. 教师将邀请码分享给学生
3. 学生通过邀请码自主加入班级
4. 教师在"学生管理"标签页查看已加入学生

这种方式确保：
✅ 每个学生账号唯一（通过微信openId识别）
✅ 无数据冲突（学生自主加入，自动关联）
✅ 实时同步（加入即刻生效）

---

## 系统概述

班级邀请码系统实现了"教师创建班级-学生自愿加入"的管理模式，解决了班级重组、学生重复等核心问题。

## 主要功能

### 1. 教师端功能
- **班级创建**：创建班级时自动生成邀请码
- **邀请码管理**：查看、复制、重新生成、禁用邀请码
- **班级分享**：支持微信分享班级邀请链接
- **学生管理**：保留直接添加学生的功能

### 2. 学生端功能
- **加入班级**：通过邀请码加入班级
- **信息确认**：完善个人资料（姓名、头像）
- **班级预览**：加入前查看班级信息

### 3. 数据管理
- **云端同步**：班级和学生数据云端备份
- **邀请记录**：完整的邀请码使用历史
- **转班支持**：学生可以跨班级转移

## 使用流程

### 教师端操作流程

#### 1. 创建班级
1. 进入"班级管理"页面
2. 点击"创建班级"按钮
3. 填写班级信息（名称、描述、年级等）
4. 系统自动生成6位数字邀请码
5. 创建成功后显示邀请码信息

#### 2. 管理邀请码
1. 在班级列表中点击"邀请码"按钮
2. 查看邀请码详细信息：
   - 邀请码：6位数字
   - 有效期：默认30天
   - 班级人数：当前/最大人数
3. 可选择操作：
   - 复制邀请码
   - 重新生成邀请码
   - 禁用邀请码

#### 3. 分享班级邀请
1. 点击班级列表中的"分享"按钮
2. 选择分享方式：
   - 微信好友
   - 微信群
   - 朋友圈
3. 分享内容包含班级邀请链接

### 学生端操作流程

#### 1. 获取邀请码
- 从教师处获取6位数字邀请码
- 或通过微信分享的链接直接访问

#### 2. 加入班级
1. 访问加入班级页面
2. 输入6位数字邀请码
3. 系统验证邀请码有效性
4. 预览班级信息（班级名称、教师、人数等）
5. 确认加入班级

#### 3. 完善个人信息
1. 输入学生姓名
2. 选择头像（可选）
3. 确认信息并加入班级

## 技术实现

### 1. 数据库结构
```sql
-- 班级表扩展字段
ALTER TABLE classes ADD COLUMN inviteCode VARCHAR(20) UNIQUE;
ALTER TABLE classes ADD COLUMN inviteCodeExpiry DATETIME;
ALTER TABLE classes ADD COLUMN maxStudents INT DEFAULT 50;
ALTER TABLE classes ADD COLUMN currentStudents INT DEFAULT 0;

-- 学生表扩展字段
ALTER TABLE students ADD COLUMN joinMethod ENUM('invite', 'direct', 'transfer');
ALTER TABLE students ADD COLUMN joinedAt DATETIME;
ALTER TABLE students ADD COLUMN previousClassId VARCHAR(50);
```

### 2. 云函数
- **manageClassInvite**：邀请码管理
- **studentJoinClass**：学生加入班级

### 3. 页面路由
- **教师端**：`pages/teacher-class/index`
- **学生端**：`pages/student-join-class/index`

## 配置说明

### 1. 邀请码设置
- **长度**：6位数字
- **有效期**：默认30天（可配置）
- **使用次数**：默认无限制（可配置）
- **生成规则**：随机生成，确保唯一性

### 2. 班级设置
- **最大人数**：默认50人（可配置）
- **加入方式**：支持邀请码和直接添加
- **状态管理**：活跃/停用

### 3. 权限控制
- **教师权限**：只能管理自己的班级
- **学生权限**：只能加入有邀请码的班级
- **数据隔离**：教师间数据完全隔离

## 常见问题

### Q1: 邀请码过期了怎么办？
A: 教师可以在班级管理中重新生成邀请码。

### Q2: 学生忘记邀请码怎么办？
A: 教师可以重新生成邀请码并分享给学生。

### Q3: 学生已经在其他班级，能加入新班级吗？
A: 可以，系统会自动处理学生转班，更新班级人数统计。

### Q4: 班级人数满了还能加入吗？
A: 不能，系统会提示"班级人数已满"。

### Q5: 邀请码可以重复使用吗？
A: 默认可以重复使用，教师可以设置使用次数限制。

## 部署步骤

### 1. 更新数据库
在云开发控制台执行：
```sql
-- 执行 database_schema_extension_invite_system.sql
```

### 2. 部署云函数
```bash
# 部署管理邀请码云函数
cd cloudfunctions/manageClassInvite
npm install

# 部署学生加入班级云函数
cd ../studentJoinClass
npm install
```

### 3. 更新小程序代码
- 更新 `miniprogram/app.json` 添加新页面路由
- 更新教师端班级管理页面
- 添加学生加入班级页面

### 4. 测试验证
1. 测试班级创建和邀请码生成
2. 测试学生加入班级流程
3. 测试邀请码管理功能
4. 测试数据同步功能

## 优势总结

### 1. 解决核心问题
- ✅ 班级重组：学生可以主动转班
- ✅ 重复学生：避免同班级重复添加
- ✅ 数据关联：学生数据直接与教师关联

### 2. 用户体验优化
- ✅ 操作简便：教师只需分享邀请码
- ✅ 学生自主：学生控制自己的班级归属
- ✅ 实时生效：加入后立即生效

### 3. 系统稳定性
- ✅ 数据一致性：云端和本地数据同步
- ✅ 错误处理：完善的错误提示和处理
- ✅ 扩展性：支持更多功能扩展

这个系统完美解决了您提到的班级重组问题，同时保持了系统的灵活性和易用性。学生可以通过邀请码自愿加入班级，避免了重复学生的问题，教师也可以更好地管理班级成员。
