# 题库迁移到云数据库操作指南

## 概述
本指南将帮助你将本地题库文件迁移到云数据库，以减小小程序包体积。

## 准备工作

### 1. 确认云开发环境
- 确保云开发环境已正确配置
- 环境ID: `cloud1-4gyu3i1id5f4e2fa`
- 确保云函数已部署

### 2. 检查当前文件
本地题库文件位置：
```
miniprogram/data/
├── intermediate_questions.js (1.4MB)
├── writing_nouns.js (22KB)
├── writing_voices.js (52KB)
├── writing_adverbs.js (5.3KB)
├── writing_comparisons.js (17KB)
├── writing_tenses.js (11KB)
└── writing_pronouns.js (17KB)
```

## 详细操作步骤

### 第一步：备份本地文件
1. 在微信开发者工具中打开控制台
2. 运行以下命令：
```javascript
// 复制并粘贴 delete_local_questions.js 的内容到控制台
backupLocalQuestionFiles()
```
3. 手动创建备份目录：`backup/local_questions_backup/`
4. 将上述7个文件复制到备份目录

### 第二步：检查云数据库状态
1. 在控制台运行：
```javascript
// 复制并粘贴 upload_questions_to_cloud.js 的内容到控制台
verifyUpload()
```
2. 查看当前云数据库中的题目数量

### 第三步：上传题库到云数据库
1. 在控制台运行：
```javascript
uploadQuestionsToCloud()
```
2. 等待上传完成（可能需要几分钟）
3. 再次运行 `verifyUpload()` 确认上传成功

### 第四步：验证云数据库数据
1. 检查各分类的题目数量是否正确
2. 确认数据完整性
3. 测试小程序功能是否正常

### 第五步：删除本地文件
**⚠️ 重要：只有在确认云数据库上传成功后才执行此步骤**

1. 在控制台运行：
```javascript
deleteLocalQuestionFiles()
```
2. 手动删除以下文件：
   - `miniprogram/data/intermediate_questions.js`
   - `miniprogram/data/writing_nouns.js`
   - `miniprogram/data/writing_voices.js`
   - `miniprogram/data/writing_adverbs.js`
   - `miniprogram/data/writing_comparisons.js`
   - `miniprogram/data/writing_tenses.js`
   - `miniprogram/data/writing_pronouns.js`

## 验证步骤

### 1. 检查小程序包大小
- 重新编译小程序
- 检查包大小是否减小了1-2MB

### 2. 测试功能
- 测试所有题库功能
- 确认题目正常显示
- 确认答题功能正常

### 3. 检查云函数调用
- 确认云函数调用正常
- 检查网络请求是否成功

## 故障排除

### 问题1：云函数调用失败
**解决方案：**
1. 检查云开发环境配置
2. 重新部署云函数
3. 检查网络连接

### 问题2：数据上传不完整
**解决方案：**
1. 检查云函数日志
2. 重新运行上传脚本
3. 检查数据库权限

### 问题3：小程序功能异常
**解决方案：**
1. 检查云数据库连接
2. 确认数据格式正确
3. 检查错误日志

## 回滚方案

如果出现问题，可以回滚到本地数据：

1. 从备份目录恢复文件
2. 修改代码使用本地数据
3. 重新编译小程序

## 注意事项

1. **备份重要**：删除前务必备份所有文件
2. **测试充分**：确保云数据库功能正常后再删除本地文件
3. **网络依赖**：使用云数据库后需要网络连接
4. **成本考虑**：云数据库有使用量限制和费用

## 预期效果

- 小程序包体积减少 1-2MB
- 启动速度略有提升
- 数据更新更方便（通过云函数）
- 更好的数据管理和备份

## 联系支持

如果遇到问题，请：
1. 查看云开发控制台日志
2. 检查微信开发者工具控制台
3. 参考云开发官方文档
