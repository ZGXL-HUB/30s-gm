# Excel文件上传功能使用说明

## 功能概述

现在系统已经完全支持Excel文件上传功能，可以批量导入学生信息。之前显示"文件选择功能开发中"的问题已经解决。

## 功能特性

### 1. 完整的Excel文件上传流程
- ✅ 支持选择Excel文件（.xlsx, .xls格式）
- ✅ 文件大小限制（最大10MB）
- ✅ 自动上传到云存储
- ✅ 云函数解析Excel内容
- ✅ 数据验证和错误处理
- ✅ 批量导入学生数据

### 2. Excel文件格式要求

**必需列（按顺序）：**
- 姓名（必填）
- 学号（必填，不能重复）
- 手机号（选填，格式验证）
- 邮箱（选填，格式验证）
- 班级（选填）

**示例格式：**
```
姓名    学号      手机号        邮箱                   班级
张三    2024001   13800138001   zhangsan@example.com   高三(1)班
李四    2024002   13800138002   lisi@example.com       高三(1)班
王五    2024003   13800138003   wangwu@example.com     高三(2)班
```

### 3. 数据验证规则

- **姓名**：不能为空
- **学号**：不能为空，不能重复（包括与现有数据重复）
- **手机号**：格式必须为11位数字，以1开头
- **邮箱**：必须符合标准邮箱格式
- **班级**：可选字段

### 4. 错误处理

系统会检查并报告以下错误：
- 缺少必要的列
- 必填字段为空
- 数据格式不正确
- 学号重复
- 文件格式不支持

## 使用方法

### 1. 下载模板
1. 进入"学生管理"页面
2. 点击"下载模板"按钮
3. 下载Excel模板文件
4. 按照模板格式填写学生信息

### 2. 导入学生
1. 点击"导入学生"按钮
2. 选择填写好的Excel文件
3. 系统自动上传并解析
4. 查看导入结果

## 技术实现

### 前端实现
- 使用 `wx.chooseMessageFile` 选择Excel文件
- 使用 `wx.cloud.uploadFile` 上传到云存储
- 调用云函数解析文件内容

### 云函数
- `parseStudentExcel`：解析Excel文件并导入学生数据
- `generateStudentTemplate`：生成Excel模板文件

### 数据验证
- 文件格式验证
- 数据完整性检查
- 重复数据检测
- 格式规范验证

## 部署说明

### 1. 部署云函数
```bash
# 部署解析Excel的云函数
cd cloudfunctions/parseStudentExcel
npm install
# 在微信开发者工具中右键选择"上传并部署"

# 部署生成模板的云函数
cd cloudfunctions/generateStudentTemplate
npm install
# 在微信开发者工具中右键选择"上传并部署"
```

### 2. 数据库权限
确保云数据库的 `students` 集合有写入权限。

## 注意事项

1. **文件大小限制**：单个Excel文件不能超过10MB
2. **数据格式**：严格按照模板格式填写，不要修改列标题
3. **学号唯一性**：确保学号在Excel文件中不重复，且不与现有数据重复
4. **网络环境**：上传大文件需要良好的网络环境

## 故障排除

### 常见问题

1. **"文件选择功能开发中"提示**
   - 原因：这是旧版本的提示，新版本已修复
   - 解决：确保使用最新代码

2. **"文件上传失败"**
   - 检查网络连接
   - 确认文件大小不超过10MB
   - 检查云开发环境配置

3. **"解析文件失败"**
   - 检查Excel文件格式是否正确
   - 确认包含所有必需的列
   - 检查数据格式是否符合要求

4. **"学号已存在"**
   - 检查Excel文件中是否有重复学号
   - 检查数据库中是否已存在相同学号
   - 修改学号后重新导入

## 更新日志

- **v1.0.0**：实现完整的Excel文件上传功能
  - 支持Excel文件选择和上传
  - 实现数据解析和验证
  - 添加错误处理和用户提示
  - 提供Excel模板下载功能
