# 命名规范化解决方案

## 问题根源

您说得对！40个小语法点 + 12个大语法点，**不应该需要复杂的映射表**。

### 当前问题

**三层不一致**:
1. **界面显示**: "介词 + 名词/动名词"、"it相关"、"时态(过去完成时)"
2. **云数据库category**: "介词(1)"、"代词(3)"、"谓语(2)"
3. **云数据库grammarPoint**: 可能又是另一套命名

**后果**:
- 需要复杂的映射表
- 映射表难以维护
- 经常找不到题目
- 每次新增语法点都要更新映射

## 📊 推荐方案

### 方案A: 分层命名系统（推荐）⭐

**格式**: `大类-小类`

**示例**:
```
介词-综合
介词-固定搭配
介词-名词动名词
代词-综合
代词-it相关
代词-人称代词
时态-过去完成时
时态-过去进行时
副词-修饰句子
副词-修饰形容词副词
```

**优点**:
- ✅ 清晰的层级关系
- ✅ 易于理解和维护
- ✅ 自动推断：如"介词-XXX"都属于"介词"大类
- ✅ 无需映射表

**实施成本**: 中等
- 修改界面显示（grammarTopics）
- 批量更新云数据库（SQL脚本）
- 简化查询逻辑

### 方案B: 编号系统

**格式**: `大类(序号)`

**示例**:
```
介词(1)、介词(2)、介词(3)
代词(1)、代词(2)、代词(3)
时态(1)、时态(2)、时态(3)
```

**优点**:
- ✅ 简洁
- ✅ 当前云数据库已部分使用

**缺点**:
- ❌ 不直观（需要记忆序号含义）
- ❌ 界面显示不友好
- ❌ 仍需要映射表（序号→描述名称）

### 方案C: 统一描述性名称

**格式**: 使用完整的描述性中文名称

**示例**:
```
介词综合
固定搭配
介词加名词动名词
代词综合
it相关用法
人称代词
时态过去完成时
副词修饰句子
```

**优点**:
- ✅ 直观易懂
- ✅ 无需映射

**缺点**:
- ❌ 名称可能很长
- ❌ 容易出现细微差异（如"+"变成"加"）

## 🎯 我的建议

### 最佳方案：方案A（分层命名）

**理由**:
1. **结构清晰**: 一眼看出层级关系
2. **易于查询**: 
   ```javascript
   // 获取大类所有题目
   where({ category: { $regex: '^介词-' } })
   
   // 获取具体小类
   where({ category: '介词-固定搭配' })
   ```
3. **自动分组**: 代码可以自动提取大类
   ```javascript
   const bigCategory = category.split('-')[0];  // "介词-综合" → "介词"
   ```
4. **扩展性强**: 新增语法点只需遵循命名规范

### 实施计划

#### Phase A1: 定义规范（1小时）

创建完整的命名对照表：
```javascript
const namingConvention = {
  // 旧命名 → 新命名
  "介词综合": "介词-综合",
  "固定搭配": "介词-固定搭配",
  "介词 + 名词/动名词": "介词-名词动名词",
  "代词综合": "代词-综合",
  "it相关": "代词-it用法",
  "人称代词": "代词-人称",
  "物主代词": "代词-物主",
  "反身代词": "代词-反身",
  "时态(过去完成时)": "时态-过去完成时",
  "时态(过去进行时)": "时态-过去进行时",
  "副词修饰句子": "副词-修饰句子",
  "副词修饰形容词/副词": "副词-修饰形容词副词",
  // ... 全部40个小点
};
```

#### Phase A2: 更新界面（30分钟）

修改 `teacher-homework/index.js` 中的 `grammarTopics`:
```javascript
points: [
  { id: '介词-综合', name: '介词-综合', questionCount: 1 },
  { id: '介词-固定搭配', name: '介词-固定搭配', questionCount: 1 },
  // ...
]
```

#### Phase A3: 更新云数据库（2小时）

```javascript
// 批量更新脚本
const updateCategories = async () => {
  const db = wx.cloud.database();
  const _ = db.command;
  
  for (const [oldName, newName] of Object.entries(namingConvention)) {
    await db.collection('questions')
      .where({ category: oldName })
      .update({
        data: { category: newName }
      });
  }
};
```

#### Phase A4: 简化查询逻辑（30分钟）

```javascript
// 之前：需要映射表
const mappedCategories = questionMapping.grammarPointToCategories[grammarPoint];

// 之后：直接查询
const result = await db.collection('questions')
  .where({ category: grammarPoint })
  .get();

// 或查询大类所有题目
const result = await db.collection('questions')
  .where({ 
    category: db.command.regex(new RegExp(`^${bigCategory}-`))
  })
  .get();
```

### 临时过渡方案（推荐先用这个）

在规范化之前，可以：

#### 方案T1: 双字段策略

云数据库题目增加 `displayName` 字段：
```javascript
{
  category: "介词(1)",  // 保持原有编号
  displayName: "介词-综合",  // 规范化名称
  grammarPoint: "介词综合"  // 兼容旧系统
}
```

查询时：
```javascript
// 先用displayName查，找不到再用category
const result1 = await db.where({ displayName: grammarPoint }).get();
if (result1.data.length === 0) {
  const result2 = await db.where({ category: mappedCategory }).get();
}
```

#### 方案T2: 改进映射表（当前使用）

在云数据库未规范化前，完善映射表：
- 运行 `check_cloud_categories.js` 查看实际分类
- 根据实际情况补充映射
- 作为临时方案使用

## 🎯 我的具体建议

### 立即行动（今天）

1. **运行 `analyze_naming_system.js`** - 了解当前命名现状
2. **运行 `check_cloud_categories.js`** - 查看云数据库实际分类
3. **补充映射表** - 根据实际情况添加缺失的映射

### 短期计划（本周）

1. **定义命名规范** - 确定使用方案A（分层命名）
2. **创建对照表** - 列出所有40个小点的新旧命名
3. **测试小范围迁移** - 选择1-2个大类先试验

### 长期计划（下周）

1. **全面规范化** - 更新所有界面和数据库
2. **移除映射表** - 简化系统架构
3. **文档更新** - 统一命名规范文档

## 📋 命名规范建议

### 规范示例

| 大类 | 小类编号 | 旧命名 | 新命名（推荐） |
|------|---------|-------|---------------|
| 介词 | 1 | 介词综合 | 介词-综合 |
| 介词 | 2 | 固定搭配 | 介词-固定搭配 |
| 介词 | 3 | 介词 + 名词/动名词 | 介词-名词动名词 |
| 代词 | 1 | 代词综合 | 代词-综合 |
| 代词 | 2 | it相关 | 代词-it用法 |
| 代词 | 3 | 人称代词 | 代词-人称 |
| 时态 | 1 | 时态(过去完成时) | 时态-过去完成时 |
| 副词 | 1 | 副词修饰句子 | 副词-修饰句子 |

### 命名规则

1. **格式**: `{大类}-{小类描述}`
2. **大类**: 使用单字或双字（介词、代词、连词、冠词、名词、动词、时态、语态、非谓语、形容词、副词）
3. **小类**: 简洁的描述性名称，避免特殊符号
4. **示例**: 
   - ✅ "介词-名词动名词"（简洁）
   - ❌ "介词 + 名词/动名词"（有特殊符号）

## 您的选择

### 选项1: 立即规范化（彻底解决）

**优点**: 一劳永逸，系统更清晰
**工作量**: 2-4小时
**风险**: 需要全面测试

### 选项2: 逐步规范化（稳妥方案）

**优点**: 风险可控，可以回滚
**工作量**: 每周1-2个大类
**风险**: 低

### 选项3: 维持现状+完善映射表

**优点**: 改动最小
**工作量**: 1小时
**风险**: 映射表会越来越复杂

## 🤔 您倾向于哪个方案？

我个人**强烈推荐方案A（分层命名）+ 选项2（逐步规范化）**:

1. **先用 `analyze_naming_system.js` 和 `check_cloud_categories.js` 分析现状**
2. **定义完整的命名对照表**
3. **选择1-2个大类（如"介词"、"代词"）先试验**
4. **验证无问题后，逐步推广到其他大类**

这样既能根本解决问题，又能控制风险。您觉得如何？
