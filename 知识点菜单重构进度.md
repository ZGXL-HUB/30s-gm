# 知识点菜单重构进度

## ✅ 已完成的工作

### 1. 数据结构创建
- ✅ 创建了 `miniprogram/config/middle-school-grammar-data.js`
- ✅ 完整的三级菜单结构（一级：词法/句法，二级：14个专题，三级：具体知识点）
- ✅ 真题数据映射（45道真题映射到知识点路径）
- ✅ 考频计算函数（支持二级和三级路径）
- ✅ 年份标注函数（支持二级和三级路径）

### 2. 数据初始化
- ✅ 在 `teacher-homework-middle/index.js` 中引入新数据结构
- ✅ 添加 `initGrammarData()` 方法初始化二级和三级菜单列表
- ✅ 添加 `switchYearPackage()` 方法用于中考配比模式的年份切换

### 3. 核心数据结构
```javascript
// 一级菜单：词法、句法（仅作为分组标签）
// 二级菜单：名词、代词、时态等（专题模式的选择目标）
// 三级菜单：具体知识点（自选模式的选择目标）

// 数据结构包含：
- id: 唯一标识
- name: 显示名称
- level: 层级（1/2/3）
- level1Id/level2Id: 上级菜单ID
- path: 知识点路径（如 '1.2.2'）
- type: 'group'/'topic'/'point'
- examFrequency: 考频（⭐⭐⭐）
- examYears: 考过的年份数组
- examRegion: 地区（云南）
- questionCount: 题目数量
```

## 🔄 待完成的工作

### 1. 中考配比模式重构
**当前状态**：已有 `executeZhongkaoSystemCombo()` 函数，但使用的是旧数据结构

**需要完成**：
- [ ] 重构 `executeZhongkaoSystemCombo()` 使用新的三级菜单数据结构
- [ ] 根据选择的年份，从 `getPointsByYear()` 获取该年份考过的知识点
- [ ] 优先选择必考知识点（时态、被动语态）
- [ ] 生成结果存储到 `zhongkaoGeneratedPoints`，包含考频和年份信息
- [ ] 更新界面显示：不显示菜单树，只显示年份选择和生成结果

### 2. 专题模式重构
**需要完成**：
- [ ] 修改 `selectGrammarTopic()` 函数，使其选择二级菜单（level2Topics）
- [ ] 一级菜单（词法/句法）仅作为分组标签显示，不可选择
- [ ] 二级菜单直接可见，显示子知识点预览
- [ ] 选择二级菜单后，自动均分题目到其下的三级菜单
- [ ] 更新界面：二级菜单作为选择项，一级菜单作为分组标签

### 3. 自选模式重构
**需要完成**：
- [ ] 修改 `selectPoint()` 函数，使其选择三级菜单（level3Points）
- [ ] 三级菜单平铺展示，按一级菜单分组
- [ ] 添加筛选功能：按年份、考频筛选
- [ ] 支持搜索功能
- [ ] 选择三级菜单后，自动均分题目
- [ ] 更新界面：三级菜单作为选择项，一级菜单作为分组标签

### 4. 界面更新
**需要完成**：
- [ ] 更新 `teacher-homework-middle/index.wxml`：
  - 中考配比模式：年份选择 + 生成结果展示（不显示菜单树）
  - 专题模式：一级菜单分组标签 + 二级菜单选择项
  - 自选模式：一级菜单分组标签 + 三级菜单选择项（支持筛选）
- [ ] 更新 `teacher-homework-middle/index.wxss`：适配新的菜单结构样式

### 5. 辅助函数
**需要完成**：
- [ ] `getGrammarPointsByCategory()` - 根据分类和年份获取知识点（使用新数据结构）
- [ ] `getAllCategories()` - 获取所有分类（使用新数据结构）
- [ ] `redistributeTopicQuestions()` - 专题模式题目分配（使用新数据结构）
- [ ] `redistributeCustomQuestions()` - 自选模式题目分配（使用新数据结构）

## 📋 实现优先级

1. **高优先级**：专题模式和自选模式的核心选择逻辑
2. **中优先级**：界面更新和样式调整
3. **低优先级**：辅助函数优化和代码清理

## 🔍 关键设计决策

1. **菜单层级使用**：
   - 一级菜单（词法/句法）：仅作为视觉分组标签，不可选择
   - 二级菜单（名词/代词/时态等）：专题模式的选择目标
   - 三级菜单（具体知识点）：自选模式的选择目标

2. **考情数据展示**：
   - 考频：⭐⭐⭐（根据真题出现次数计算）
   - 年份：2023, 2024, 2025（显示考过的年份）
   - 地区：云南（固定显示）

3. **操作流程**：
   - 中考配比：年份选择 → 一键生成 → 显示结果（2步）
   - 专题模式：设置题型 → 选择二级菜单 → 自动均分 → 可微调 → 预览（3-4步）
   - 自选模式：设置题型 → 筛选 → 选择三级菜单 → 自动均分 → 可微调 → 预览（4-5步）

## 📝 注意事项

1. **数据兼容性**：保留旧的 `grammarTopics` 数据结构用于兼容，后续可删除
2. **函数命名**：使用 `-middle` 后缀区分初中版函数
3. **错误处理**：添加适当的错误处理和用户提示
4. **性能优化**：如果知识点数量多，考虑使用虚拟滚动

## 🎯 下一步行动

1. 重构专题模式的选择逻辑
2. 重构自选模式的选择逻辑
3. 更新界面组件
4. 测试三个模式的完整流程

