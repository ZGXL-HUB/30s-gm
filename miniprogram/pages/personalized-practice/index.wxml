<!--ä¸ªæ€§åŒ–æ¯æ—¥ç»ƒä¹ é¡µé¢-->
<view class="container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="header">
    <view class="header-title">ä¸ªæ€§åŒ–æ¯æ—¥ç»ƒä¹ </view>
    <view class="header-subtitle">åŸºäºæ‚¨çš„èƒ½åŠ›æ°´å¹³æ™ºèƒ½æ¨è</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-text">åˆ†ææ‚¨çš„å­¦ä¹ æ•°æ®ä¸­...</view>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view class="content" wx:else>
    <!-- èƒ½åŠ›æ¦‚è§ˆ -->
    <view class="ability-overview">
      <view class="overview-title">æ‚¨çš„èƒ½åŠ›æ¦‚è§ˆ</view>
      <view class="ability-cards">
        <view class="ability-card">
          <view class="card-label">è¯­æ³•æ°´å¹³</view>
          <view class="card-value level-{{abilityProfile.grammarLevel}}">
            {{abilityProfile.grammarLevel === 'level1' ? 'è¾ƒä¸ºè–„å¼±' : 
              abilityProfile.grammarLevel === 'level2' ? 'ç¨å¼±' : 
              abilityProfile.grammarLevel === 'level3' ? 'ä¸é”™å“¦' : 
              abilityProfile.grammarLevel === 'level4' ? 'è¶…æ£’çš„' : 'ç®€ç›´å®Œç¾'}}
          </view>
        </view>
        <view class="ability-card">
          <view class="card-label">ä¹¦å†™æ°´å¹³</view>
          <view class="card-value level-{{abilityProfile.writingLevel}}">
            {{abilityProfile.writingLevel === 'level1' ? 'è¾ƒä¸ºè–„å¼±' : 
              abilityProfile.writingLevel === 'level2' ? 'ç¨å¼±' : 
              abilityProfile.writingLevel === 'level3' ? 'ä¸é”™å“¦' : 
              abilityProfile.writingLevel === 'level4' ? 'è¶…æ£’çš„' : 'ç®€ç›´å®Œç¾'}}
          </view>
        </view>
        <view class="ability-card">
          <view class="card-label">è¿ç»­å­¦ä¹ </view>
          <view class="card-value">{{abilityProfile.learningProgress.streakDays}}å¤©</view>
        </view>
      </view>
    </view>

    <!-- æ¯æ—¥ä»»åŠ¡æ¨è -->
    <view class="section">
      <view class="section-header">
        <view class="section-title">ğŸ“… ä»Šæ—¥æ¨èä»»åŠ¡</view>
        <view class="section-subtitle">æ ¹æ®æ‚¨çš„å­¦ä¹ è¿›åº¦æ™ºèƒ½ç”Ÿæˆ</view>
      </view>
      <view class="task-list">
        <view class="task-item" 
              wx:for="{{recommendations.dailyTasks}}" 
              wx:key="index"
              bindtap="onDailyTaskTap"
              data-index="{{index}}">
          <view class="task-icon">{{item.type === 'weak_point_grammar' ? 'ğŸ¯' : 
                                   item.type === 'balanced_grammar' ? 'ğŸ“' : 
                                   item.type === 'writing_practice' ? 'âœï¸' : 'ğŸ¯'}}</view>
          <view class="task-content">
            <view class="task-title">{{item.title}}</view>
            <view class="task-desc">{{item.description}}</view>
            <view class="task-meta">
              <text class="task-count">{{item.questionCount}}é¢˜</text>
              <text class="task-xp">+{{item.xpReward}} XP</text>
            </view>
          </view>
          <view class="task-priority priority-{{item.priority}}">{{item.priority === 'high' ? 'é«˜' : 'ä¸­'}}</view>
        </view>
      </view>
    </view>

    <!-- ä¸“é¡¹ç»ƒä¹ æ¨è -->
    <view class="section" wx:if="{{recommendations.focusedPractice.length > 0}}">
      <view class="section-header">
        <view class="section-title">ğŸ¯ ä¸“é¡¹çªç ´ç»ƒä¹ </view>
        <view class="section-subtitle">é’ˆå¯¹æ‚¨çš„è–„å¼±ç¯èŠ‚</view>
      </view>
      <view class="practice-list">
        <view class="practice-item" 
              wx:for="{{recommendations.focusedPractice}}" 
              wx:key="index"
              bindtap="onFocusedPracticeTap"
              data-index="{{index}}">
          <view class="practice-icon">ğŸ”</view>
          <view class="practice-content">
            <view class="practice-title">{{item.title}}</view>
            <view class="practice-desc">{{item.description}}</view>
            <view class="practice-meta">
              <text class="practice-count">{{item.questionCount}}é¢˜</text>
              <text class="practice-xp">+{{item.xpReward}} XP</text>
            </view>
          </view>
          <view class="practice-arrow">></view>
        </view>
      </view>
    </view>

    <!-- ç»¼åˆç»ƒä¹ æ¨è -->
    <view class="section" wx:if="{{recommendations.comprehensivePractice.length > 0}}">
      <view class="section-header">
        <view class="section-title">ğŸš€ ç»¼åˆèƒ½åŠ›æå‡</view>
        <view class="section-subtitle">å…¨é¢æå‡æ‚¨çš„è¯­æ³•èƒ½åŠ›</view>
      </view>
      <view class="practice-list">
        <view class="practice-item" 
              wx:for="{{recommendations.comprehensivePractice}}" 
              wx:key="index"
              bindtap="onComprehensivePracticeTap"
              data-index="{{index}}">
          <view class="practice-icon">ğŸ¯</view>
          <view class="practice-content">
            <view class="practice-title">{{item.title}}</view>
            <view class="practice-desc">{{item.description}}</view>
            <view class="practice-meta">
              <text class="practice-count">{{item.questionCount}}é¢˜</text>
              <text class="practice-xp">+{{item.xpReward}} XP</text>
            </view>
          </view>
          <view class="practice-arrow">></view>
        </view>
      </view>
    </view>

    <!-- å­¦ä¹ è·¯å¾„ -->
    <view class="section" wx:if="{{recommendations.learningPath.length > 0}}">
      <view class="section-header">
        <view class="section-title">ğŸ“ˆ æ¨èå­¦ä¹ è·¯å¾„</view>
        <view class="section-subtitle">ä¸ºæ‚¨é‡èº«å®šåˆ¶çš„å­¦ä¹ è®¡åˆ’</view>
      </view>
      <view class="path-list">
        <view class="path-item" 
              wx:for="{{recommendations.learningPath}}" 
              wx:key="step">
          <view class="path-step">{{item.step}}</view>
          <view class="path-content">
            <view class="path-action">{{item.action}}</view>
            <view class="path-target">{{item.target}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="action-btn secondary" bindtap="reassessAbility">
      é‡æ–°è¯„ä¼°èƒ½åŠ›
    </button>
    <button class="action-btn secondary" bindtap="refreshRecommendations">
      åˆ·æ–°æ¨è
    </button>
    <button class="action-btn primary" bindtap="viewLearningPath">
      æŸ¥çœ‹å­¦ä¹ è·¯å¾„
    </button>
  </view>

  <!-- ä»»åŠ¡è¯¦æƒ…å¼¹çª— -->
  <view class="task-detail-modal" wx:if="{{showTaskDetail}}">
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">{{selectedTask.title}}</view>
        <view class="modal-close" bindtap="closeTaskDetail">Ã—</view>
      </view>
      <view class="modal-body">
        <view class="modal-desc">{{selectedTask.description}}</view>
        <view class="modal-meta">
          <view class="meta-item">
            <text class="meta-label">é¢˜ç›®æ•°é‡ï¼š</text>
            <text class="meta-value">{{selectedTask.questionCount}}é¢˜</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">éš¾åº¦ç­‰çº§ï¼š</text>
            <text class="meta-value">{{selectedTask.difficulty === 'easy' ? 'ç®€å•' : 
                                     selectedTask.difficulty === 'medium' ? 'ä¸­ç­‰' : 'å›°éš¾'}}</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">ç»éªŒå¥–åŠ±ï¼š</text>
            <text class="meta-value">+{{selectedTask.xpReward}} XP</text>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button class="modal-btn secondary" bindtap="closeTaskDetail">å–æ¶ˆ</button>
        <button class="modal-btn primary" bindtap="startPractice">å¼€å§‹ç»ƒä¹ </button>
      </view>
    </view>
  </view>
</view>
