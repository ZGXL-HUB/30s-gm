<!--简易版书写能力测试页面-->
<view class="container">
  <!-- 欢迎界面 -->
  <view class="welcome-screen" wx:if="{{testState === 'welcome'}}">
    <view class="welcome-content">
      <view class="welcome-title">🎯 重测书写能力（简易版）</view>
      <view class="welcome-message">
        亲爱的用户，现在让我们通过12道题快速测试您的书写能力，我会根据您的测试结果给出针对性的练习建议！
      </view>
      <view class="test-info">
        <view class="info-item">📝 题目数量：12道</view>
        <view class="info-item">⏱️ 预计时间：8-10分钟</view>
        <view class="info-item">🎯 测试目的：快速筛查6个核心表格的掌握情况</view>
      </view>
      <button class="start-btn" bindtap="startTest">开始简易测试</button>
    </view>
  </view>

  <!-- 测试界面 -->
  <view class="test-screen" wx:if="{{testState === 'testing'}}">
    <view class="progress-header">
      <view class="progress-title">简易版书写能力测试</view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(currentQuestionIndex + 1) / totalQuestions * 100}}%"></view>
      </view>
      <view class="progress-text">第{{currentQuestionIndex + 1}}题 / 共{{totalQuestions}}题</view>
    </view>
    
    <view class="question-card" wx:if="{{currentQuestion}}">
      <view class="question-header">
        <text class="question-number">第{{currentQuestionIndex + 1}}题</text>
        <text class="question-type">书写能力测试</text>
      </view>
      
      <view class="question-content">
        <text class="question-text">{{currentQuestion.question}}</text>
      </view>
      
      <view class="answer-input-container">
        <input 
          class="answer-input" 
          placeholder="请输入您的答案" 
          value="{{userAnswer}}"
          bindinput="onInputChange"
          disabled="{{showAnswer}}"
        />
      </view>
      
      <!-- 答案反馈 -->
      <view class="answer-feedback" wx:if="{{showAnswer}}">
        <view class="feedback-header {{isCorrect ? 'correct' : 'incorrect'}}">
          <view class="feedback-icon">{{isCorrect ? '✓' : '✗'}}</view>
          <view class="feedback-text">{{isCorrect ? '回答正确！' : '回答错误'}}</view>
        </view>
        
        <view class="correct-answer" wx:if="{{!isCorrect}}">
          <text>正确答案：{{currentQuestion.answer}}</text>
        </view>
        
        <view class="question-analysis" wx:if="{{currentQuestion.analysis}}">
          <text>{{currentQuestion.analysis}}</text>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="action-buttons">
        <button wx:if="{{!showAnswer}}" 
                class="action-btn {{userAnswer ? 'primary' : 'disabled'}}" 
                disabled="{{!userAnswer}}"
                bindtap="submitAnswer">
          {{userAnswer ? '提交答案' : '请输入答案'}}
        </button>
        
        <button wx:if="{{showAnswer}}" 
                class="action-btn primary" 
                bindtap="nextQuestion">
          {{currentQuestionIndex + 1 >= totalQuestions ? '完成测试' : '下一题'}}
        </button>
      </view>
    </view>
  </view>

  <!-- 结果界面 -->
  <view class="result-screen" wx:if="{{testState === 'result'}}">
    <view class="result-content">
      <view class="result-title">🎉 测试完成！</view>
      
      <view class="score-display">
        <view class="score-circle">
          <text class="score-number">{{score}}</text>
          <text class="score-label">分</text>
        </view>
        <view class="score-description">
          <text>正确率：{{score}}%</text>
          <text>（{{correctCount}}/{{totalQuestions}}题）</text>
        </view>
      </view>

      <view class="user-level">
        <text class="level-title">用户等级：{{recommendation.level}}</text>
        <text class="level-message">{{recommendation.message}}</text>
      </view>

      <view class="weak-points" wx:if="{{weakPoints.length > 0}}">
        <view class="weak-points-title">薄弱环节：</view>
        <view class="weak-points-list">
          <view class="weak-point-item" wx:for="{{weakPoints}}" wx:key="tag">
            <text>• {{item.name}} (错误率: {{item.errorRatePercent}}%)</text>
          </view>
        </view>
      </view>

      <view class="recommendation">
        <view class="recommendation-title">学习建议：</view>
        <text class="recommendation-text">{{recommendation.suggestion}}</text>
      </view>

      <view class="next-steps">
        <view class="next-steps-title">建议学习路径：</view>
        <view class="next-steps-list">
          <view class="next-step-item" wx:for="{{recommendation.nextSteps}}" wx:key="index">
            <text>• {{item}}</text>
          </view>
        </view>
      </view>

      <view class="action-buttons">
        <button class="action-btn secondary" bindtap="viewDetailedReport">
          查看详细报告
        </button>
        <button class="action-btn secondary" bindtap="saveWrongQuestions">
          保存错题到每日任务
        </button>
      </view>

      <!-- 反馈入口 -->
      <view class="feedback-section">
        <view class="feedback-title">测试体验如何？</view>
        <view class="feedback-desc">您的反馈帮助我们不断改进测试质量</view>
        <button class="feedback-btn" bindtap="goToFeedback" data-type="experience" data-context="simple_writing_test">
          💬 反馈测试体验
        </button>
      </view>

      <view class="navigation-buttons">
        <button class="nav-btn primary" bindtap="enterAdvancedJourney" wx:if="{{score >= 70}}">
          进入进阶之旅
        </button>
        <button class="nav-btn primary" bindtap="enterComprehensivePractice" wx:if="{{score >= 85}}">
          进入综合练习
        </button>
        <button class="nav-btn primary" bindtap="enterWritingStandards" wx:if="{{score < 70}}">
          进入书写规范界面
        </button>
      </view>

      <view class="bottom-actions">
        <button class="bottom-btn secondary" bindtap="retakeTest">
          重新测试
        </button>
        <button class="bottom-btn primary" bindtap="goHome">
          返回主页
        </button>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-section" wx:if="{{loading}}">
    <view class="loading-text">正在加载测试题目...</view>
  </view>
</view>
