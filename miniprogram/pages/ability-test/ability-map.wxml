<!--èƒ½åŠ›å›¾è°±é¡µé¢-->
<view class="container">

  <!-- èƒ½åŠ›å›¾è°±å±•ç¤ºå¡ç‰‡ -->
  <view class="ability-map-card">
    <view class="map-header">
      <view class="map-icon">ğŸ“Š</view>
      <view class="map-title">èƒ½åŠ›å›¾è°±</view>
      <view class="map-subtitle">æ‚¨çš„è¯­æ³•å’Œä¹¦å†™èƒ½åŠ›åˆ†ææŠ¥å‘Š</view>
    </view>

    <!-- æ ¸å¿ƒè¯„åˆ†å¡ç‰‡ -->
    <view class="score-cards">
    <!-- æ€»ä½“è¯„åˆ† -->
    <view class="score-card main-score">
      <view class="score-label">æ€»åˆ†</view>
      <view class="score-display">
        <view class="score-number">{{overallScore}}</view>
        <view class="score-max">/100</view>
      </view>
      <view class="score-level" style="color: {{getScoreLevel(overallScore).color}}">
        {{getScoreLevel(overallScore).icon}} {{getScoreLevel(overallScore).level}}
      </view>
    </view>

    <!-- è¯­æ³•å¾—åˆ† -->
    <view class="score-card">
      <view class="score-label">è¯­æ³•å¾—åˆ†</view>
      <view class="score-display">
        <view class="score-number">{{grammarScore}}</view>
        <view class="score-max">/100</view>
      </view>
      <view class="score-progress">
        <view class="progress-text">{{testedGrammarPoints}}/{{totalGrammarPoints}} å®Œæˆ</view>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{(testedGrammarPoints/totalGrammarPoints)*100}}%"></view>
        </view>
      </view>
    </view>

    <!-- ä¹¦å†™å¾—åˆ† -->
    <view class="score-card">
      <view class="score-label">ä¹¦å†™å¾—åˆ†</view>
      <view class="score-display">
        <view class="score-number">{{writingScore}}</view>
        <view class="score-max">/100</view>
      </view>
      <view class="score-progress">
        <view class="progress-text">{{testedWritingTables}}/{{totalWritingTables}} å®Œæˆ</view>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{(testedWritingTables/totalWritingTables)*100}}%"></view>
        </view>
      </view>
    </view>
    </view>

    <!-- è¯¦æƒ…å’Œç»§ç»­å®Œæˆå…¥å£ -->
  <view class="action-cards">
    <view class="action-card" bindtap="showDetailModal">
      <view class="action-icon">ğŸ“Š</view>
      <view class="action-content">
        <view class="action-title">æŸ¥çœ‹è¯¦æƒ…</view>
        <view class="action-desc">è¯¦ç»†åˆ†ææŠ¥å‘Š</view>
      </view>
      <view class="action-arrow">></view>
    </view>

    <view class="action-card" bindtap="showContinueModal" wx:if="{{hasIncompleteTests}}">
      <view class="action-icon">ğŸ¯</view>
      <view class="action-content">
        <view class="action-title">ç»§ç»­å®Œæˆ</view>
        <view class="action-desc">å®Œæˆæœªå®Œæˆçš„æµ‹è¯•</view>
      </view>
      <view class="action-arrow">></view>
    </view>
    </view>

    <!-- ä¸»è¦æ“ä½œæŒ‰é’® -->
  <view class="main-actions">
    <button class="main-btn primary" bindtap="startGrammarTest">
      å¼€å§‹è¯­æ³•ç»ƒä¹ 
    </button>
    <button class="main-btn primary" bindtap="startWritingTest">
      å¼€å§‹ä¹¦å†™ç»ƒä¹ 
    </button>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-actions">
    <button class="bottom-btn secondary" bindtap="retestAll">
      é‡æµ‹æ‰€æœ‰
    </button>
    <button class="bottom-btn secondary" bindtap="goBack">
      è¿”å›ä¸»é¡µ
    </button>
    </view>
  </view>

  <!-- è¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showDetailModal}}" bindtap="hideDetailModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <view class="modal-title">è¯¦ç»†åˆ†ææŠ¥å‘Š</view>
        <view class="modal-close" bindtap="hideDetailModal">Ã—</view>
      </view>
      
      <scroll-view class="modal-body" scroll-y>
        <!-- è¯­æ³•èƒ½åŠ›åˆ†æ -->
        <view class="detail-section">
          <view class="section-title">
            <view class="title-icon">ğŸ“š</view>
            <view class="title-text">è¯­æ³•èƒ½åŠ›åˆ†æ</view>
          </view>
          
          <view class="category-grid">
            <view wx:for="{{grammarCategories}}" wx:key="index" wx:for-item="category"
                  class="category-item {{categoryScores[category] >= 0 ? 'tested' : 'untested'}}">
              <view class="category-name">{{category}}</view>
              <view class="category-score" wx:if="{{categoryScores[category] >= 0}}">
                {{categoryScores[category]}}åˆ†
              </view>
              <view class="category-status" wx:else>æœªæµ‹è¯•</view>
              <view class="category-level" wx:if="{{categoryScores[category] >= 0}}">
                {{getScoreLevel(categoryScores[category]).level}}
              </view>
            </view>
          </view>
        </view>

        <!-- ä¹¦å†™èƒ½åŠ›åˆ†æ -->
        <view class="detail-section">
          <view class="section-title">
            <view class="title-icon">âœï¸</view>
            <view class="title-text">ä¹¦å†™èƒ½åŠ›åˆ†æ</view>
          </view>
          
          <view class="table-grid">
            <view wx:for="{{writingTables}}" wx:key="index" wx:for-item="table"
                  class="table-item {{tableScores[table] >= 0 ? 'tested' : 'untested'}}">
              <view class="table-name">{{table}}</view>
              <view class="table-score" wx:if="{{tableScores[table] >= 0}}">
                {{tableScores[table]}}åˆ†
              </view>
              <view class="table-status" wx:else>æœªæµ‹è¯•</view>
              <view class="table-level" wx:if="{{tableScores[table] >= 0}}">
                {{getScoreLevel(tableScores[table]).level}}
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- ç»§ç»­å®Œæˆæ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showContinueModal}}" bindtap="hideContinueModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <view class="modal-title">ç»§ç»­å®Œæˆæµ‹è¯•</view>
        <view class="modal-close" bindtap="hideContinueModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="continue-options">
          <view class="continue-item" wx:if="{{incompleteGrammarCount > 0}}" bindtap="continueGrammarTest">
            <view class="continue-icon">ğŸ“š</view>
            <view class="continue-content">
              <view class="continue-title">ç»§ç»­è¯­æ³•æµ‹è¯•</view>
              <view class="continue-desc">è¿˜æœ‰ {{incompleteGrammarCount}} ä¸ªè¯­æ³•ç‚¹æœªæµ‹è¯•</view>
            </view>
            <view class="continue-arrow">></view>
          </view>
          
          <view class="continue-item" wx:if="{{incompleteWritingCount > 0}}" bindtap="continueWritingTest">
            <view class="continue-icon">âœï¸</view>
            <view class="continue-content">
              <view class="continue-title">ç»§ç»­ä¹¦å†™æµ‹è¯•</view>
              <view class="continue-desc">è¿˜æœ‰ {{incompleteWritingCount}} ä¸ªè¡¨æ ¼æœªæµ‹è¯•</view>
            </view>
            <view class="continue-arrow">></view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æµ®åŠ¨åé¦ˆæŒ‰é’® -->
  <floating-feedback show="{{true}}" />
</view>
