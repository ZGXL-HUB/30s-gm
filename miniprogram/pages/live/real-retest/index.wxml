<view class="container">
  <view wx:if="{{loading}}" class="loading">加载中...</view>

  <view wx:elif="{{showResult}}" class="result-page">
    <view class="result-title">第七环节：真题再练</view>
    <view class="result-rate">本次正确率 {{correctRate}}%</view>
    <view wx:if="{{firstRate !== null}}" class="compare">第一环节 {{firstRate}}% → 第七环节 {{correctRate}}%</view>
    <view wx:else class="compare">未参与第一环节，仅展示本次正确率</view>
    <view class="stars-row">
      <text class="stars">{{stars === 1 ? '★' : ''}}{{stars === 2 ? '★★' : ''}}{{stars === 3 ? '★★★' : ''}}</text>
      <text class="stars-desc">{{stars === 1 ? '降低一颗星' : ''}}{{stars === 2 ? '持平两颗星' : ''}}{{stars === 3 ? '进步三颗星' : ''}}</text>
    </view>
    <view class="encourage">{{encourageCopy}}</view>
    <button class="btn primary" bindtap="goToNextSegment">下一环节</button>
    <view class="back-link" bindtap="backToActivity">返回活动首页</view>
  </view>

  <view wx:elif="{{questions.length}}" class="content">
    <view class="section-title">{{sectionTitle}}</view>
    <view class="action-row">
      <button class="btn hint-btn" bindtap="showHint">查看提示</button>
      <button class="btn skip-btn" bindtap="skipSegment">跳过本组练习</button>
    </view>
    <view class="progress">第 {{currentIndex + 1}} / {{questions.length}} 题</view>
    <view class="q-box">
      <view class="q-text">{{questions[currentIndex].text}}</view>
      <view class="blanks">
        <block wx:for="{{questions[currentIndex].blanks}}" wx:key="index">
          <view class="blank-row">
            <text class="blank-label">空{{index + 1}}：</text>
            <input
              class="blank-input"
              placeholder="填写答案"
              value="{{answers[currentIndex][index]}}"
              data-qi="{{currentIndex}}"
              data-bi="{{index}}"
              bindinput="onBlankInput"
              disabled="{{checked[currentIndex][index]}}"
            />
            <text wx:if="{{checked[currentIndex][index]}}" class="check-mark">✓</text>
          </view>
        </block>
      </view>
      <button class="btn primary" bindtap="checkQuestion">核对本题</button>
    </view>
    <view class="nav-row">
      <button class="btn outline" bindtap="prevQuestion" disabled="{{currentIndex <= 0}}">上一题</button>
      <button class="btn outline" bindtap="nextQuestion" disabled="{{currentIndex >= questions.length - 1}}">下一题</button>
    </view>
    <view class="back-link" bindtap="backToActivity">返回活动首页</view>
  </view>

  <view wx:if="{{showHint}}" class="modal-mask" catchtap="hideHint">
    <view class="modal-box" catchtap="">
      <view class="modal-title">知识点提示</view>
      <view class="modal-body">{{hintContent}}</view>
      <button class="btn primary" bindtap="hideHint">知道了</button>
    </view>
  </view>

  <view wx:if="{{showSkipConfirm}}" class="modal-mask" catchtap="skipCancel">
    <view class="modal-box" catchtap="">
      <view class="modal-title">跳过本组练习</view>
      <view class="modal-body">本组练习的正确率依然按照总体数量计算，并与第一次测试形成对比数据，是否跳过？</view>
      <view class="modal-actions">
        <button class="btn outline" bindtap="skipCancel">取消</button>
        <button class="btn primary" bindtap="skipConfirm">确定</button>
      </view>
    </view>
  </view>
</view>
