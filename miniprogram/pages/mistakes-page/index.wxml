<view class="container">
  <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-header">
      <view class="stats-title">é”™é¢˜ç»Ÿè®¡</view>
      <view class="stats-actions">
        <view class="action-btn" bindtap="showLearningAnalysis">
          <text class="btn-icon">ğŸ“Š</text>
          <text class="btn-text">åˆ†æ</text>
        </view>
        <view class="action-btn" bindtap="showLearningProgress">
          <text class="btn-icon">ğŸ“ˆ</text>
          <text class="btn-text">è¿›åº¦</text>
        </view>
        <view class="action-btn danger" bindtap="clearAllMistakes" wx:if="{{mistakes.length > 0}}">
          <text class="btn-icon">ğŸ—‘ï¸</text>
          <text class="btn-text">æ¸…ç©º</text>
        </view>
      </view>
    </view>
    
    <view class="stats-content">
      <view class="stat-item">
        <view class="stat-number">{{learningProgress.totalMistakes}}</view>
        <view class="stat-label">æ€»é”™é¢˜</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{learningProgress.masteredMistakes}}</view>
        <view class="stat-label">å·²æŒæ¡</view>
      </view>
      <view class="stat-item">
        <view class="stat-number">{{learningProgress.masteryRate}}%</view>
        <view class="stat-label">æŒæ¡ç‡</view>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ åˆ†æé¢æ¿ -->
  <view class="analysis-panel" wx:if="{{showAnalysis}}">
    <view class="panel-header">
      <text class="panel-title">ğŸ“Š å­¦ä¹ åˆ†æ</text>
      <view class="panel-close" bindtap="showLearningAnalysis">Ã—</view>
    </view>
    
    <view class="analysis-content">
      <!-- æœ€å¸¸å‡ºé”™ç±»åˆ« -->
      <view class="analysis-item">
        <view class="analysis-label">æœ€å¸¸å‡ºé”™ï¼š</view>
        <view class="analysis-value">{{analysisData.mostErrorCategory || 'æš‚æ— æ•°æ®'}}</view>
        <view class="analysis-detail">å…±{{analysisData.mostErrorCount}}æ¬¡</view>
      </view>
      
      <!-- å¹³å‡é”™è¯¯æ¬¡æ•° -->
      <view class="analysis-item">
        <view class="analysis-label">å¹³å‡é”™è¯¯ï¼š</view>
        <view class="analysis-value">{{analysisData.averageErrorCount}}æ¬¡/é¢˜</view>
      </view>
      
      <!-- æ”¹è¿›è¶‹åŠ¿ -->
      <view class="analysis-item">
        <view class="analysis-label">å­¦ä¹ è¶‹åŠ¿ï¼š</view>
        <view class="analysis-value trend-{{analysisData.improvementTrend}}">
          {{analysisData.improvementTrend === 'improving' ? 'ğŸ“ˆ è¿›æ­¥ä¸­' : 
            analysisData.improvementTrend === 'declining' ? 'ğŸ“‰ éœ€åŠ å¼º' : 'â¡ï¸ ç¨³å®š'}}
        </view>
      </view>
      
      <!-- æ¨èé‡ç‚¹ -->
      <view class="recommendations">
        <view class="recommendations-title">ğŸ’¡ æ¨èé‡ç‚¹</view>
        <view class="recommendation-list">
          <view wx:for="{{analysisData.recommendedFocus}}" wx:key="category" class="recommendation-item">
            <view class="recommendation-priority">{{item.priority}}</view>
            <view class="recommendation-text">{{item.recommendation}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ è¿›åº¦é¢æ¿ -->
  <view class="progress-panel" wx:if="{{showProgress}}">
    <view class="panel-header">
      <text class="panel-title">ğŸ“ˆ å­¦ä¹ è¿›åº¦</text>
      <view class="panel-close" bindtap="showLearningProgress">Ã—</view>
    </view>
    
    <view class="progress-content">
      <!-- è–„å¼±ç‚¹å’Œå¼ºé¡¹ -->
      <view class="progress-section">
        <view class="section-title">ğŸ¯ è–„å¼±ç‚¹</view>
        <view class="point-list">
          <view wx:for="{{learningProgress.weakPoints}}" wx:key="*this" class="point-item weak">
            {{item}}
          </view>
        </view>
      </view>
      
      <view class="progress-section">
        <view class="section-title">âœ… å¼ºé¡¹</view>
        <view class="point-list">
          <view wx:for="{{learningProgress.strongPoints}}" wx:key="*this" class="point-item strong">
            {{item}}
          </view>
        </view>
      </view>
      
      <!-- æœ€è¿‘7å¤©è¿›åº¦ -->
      <view class="progress-section">
        <view class="section-title">ğŸ“… æœ€è¿‘7å¤©</view>
        <view class="progress-chart">
          <view wx:for="{{learningProgress.recentProgress}}" wx:key="date" class="chart-bar">
            <view class="bar-fill" style="height: {{item.count * 10}}px;"></view>
            <view class="bar-label">{{item.count}}</view>
          </view>
        </view>
      </view>
    </view>
  </view>



  <!-- ç»ƒä¹ åŠŸèƒ½æ•´åˆåŒºåŸŸ -->
  <view class="practice-section" wx:if="{{filteredMistakes.length > 0}}">
    <view class="practice-header">
      <text class="practice-title">ğŸ“š ç»ƒä¹ ä¸­å¿ƒ</text>
      <view class="practice-help" bindtap="showPracticeHelp">
        <text class="help-icon">â“</text>
      </view>
    </view>
    
    <view class="practice-cards">
      <!-- æ™ºèƒ½æ¨èç»ƒä¹ å¡ç‰‡ -->
      <view class="practice-card recommendation-card" wx:if="{{analysisData.recommendedFocus.length > 0}}">
        <view class="card-header">
          <view class="card-icon">ğŸ¯</view>
          <view class="card-info">
            <text class="card-title">æ™ºèƒ½æ¨èç»ƒä¹ </text>
            <text class="card-desc">åŸºäºé”™é¢˜åˆ†æï¼Œæ¨èè–„å¼±è¯­æ³•ç‚¹</text>
          </view>
        </view>
        <view class="card-content">
          <text class="recommendation-text">{{analysisData.recommendedFocus[0].recommendation || 'æš‚æ— æ¨è'}}</text>
        </view>
        <view class="card-actions">
          <button class="action-btn primary" bindtap="startRecommendedPractice">
            <text class="btn-text">å¼€å§‹ç»ƒä¹ </text>
            <text class="btn-arrow">â†’</text>
          </button>
        </view>
      </view>

      <!-- é”™é¢˜æ¶ˆç­ç»ƒä¹ å¡ç‰‡ -->
      <view class="practice-card elimination-card">
        <view class="card-header">
          <view class="card-icon">âš”ï¸</view>
          <view class="card-info">
            <text class="card-title">é”™é¢˜æ¶ˆç­ç»ƒä¹ </text>
            <text class="card-desc">é‡å¤ç»ƒä¹ é”™é¢˜ï¼Œåšå¯¹{{autoRemoveConfig.correctCount}}æ¬¡è‡ªåŠ¨ç§»é™¤</text>
          </view>
          <view class="card-config" bindtap="showAutoRemoveSettings">
            <text class="config-text">è®¾ç½®</text>
          </view>
        </view>
        <view class="card-content">
          <view class="progress-info">
            <text class="progress-text">å½“å‰è¿›åº¦ï¼š{{mistakes.length}}é“é”™é¢˜å¾…æ¶ˆç­</text>
          </view>
        </view>
        <view class="card-actions">
          <button class="action-btn primary" bindtap="startEliminationPractice">
            <text class="btn-text">å¼€å§‹æ¶ˆç­</text>
            <text class="btn-arrow">â†’</text>
          </button>
          <button class="action-btn secondary" bindtap="showEliminationProgress">
            <text class="btn-text">æŸ¥çœ‹è¿›åº¦</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å·²ç§»é™¤é”™é¢˜å…¥å£ -->
  <view class="removed-mistakes-section" wx:if="{{removedMistakes.length > 0}}">
    <view class="removed-mistakes-header" bindtap="toggleRemovedMistakes">
      <view class="removed-mistakes-title">
        <text class="removed-icon">ğŸ—‘ï¸</text>
        <text>å·²ç§»é™¤é”™é¢˜ ({{removedMistakes.length}})</text>
      </view>
      <view class="removed-mistakes-arrow">{{showRemovedMistakes ? 'â–¼' : 'â–¶'}}</view>
    </view>
    
    <!-- å·²ç§»é™¤é”™é¢˜åˆ—è¡¨ -->
    <view class="removed-mistakes-list" wx:if="{{showRemovedMistakes}}">
      <block wx:for="{{removedMistakes}}" wx:key="id">
        <view class="removed-mistake-item">
          <view class="removed-mistake-info">
            <view class="removed-mistake-text">{{item.question}}</view>
            <view class="removed-mistake-reason">å› åšå¯¹{{item.removedReason.correctCount}}æ¬¡è¢«ç§»é™¤</view>
            <view class="removed-mistake-date">{{item.removedDate}}</view>
          </view>
          <view class="restore-btn" bindtap="restoreMistake" data-id="{{item.id}}">æ¢å¤</view>
        </view>
      </block>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="filter-section">
    <view class="filter-header">
      <text class="filter-title">åˆ†ç±»ç­›é€‰</text>
      <view class="filter-count">å…±{{filteredMistakes.length}}é“</view>
    </view>
    
    <view class="category-tabs">
      <view class="tab-item {{currentCategory === 'all' ? 'active' : ''}}" 
            bindtap="filterByCategory" data-category="all">
        å…¨éƒ¨
      </view>
      <view wx:for="{{categories}}" wx:key="*this" 
            class="tab-item {{currentCategory === item ? 'active' : ''}}"
            bindtap="filterByCategory" data-category="{{item}}">
        {{item}} ({{categoryCounts[item] || 0}})
      </view>
    </view>
  </view>

  <!-- é”™é¢˜åˆ—è¡¨ -->
  <view class="mistake-list">
    <block wx:for="{{filteredMistakes}}" wx:key="id">
      <view class="mistake-item">
        <view class="mistake-header">
          <view class="mistake-category">{{item.mappedCategory || item.category || 'ç»¼åˆ'}}</view>
          <view class="mistake-actions">
            <view class="action-btn small" bindtap="practiceMistake" data-index="{{index}}">
              <text class="btn-icon">âœï¸</text>
            </view>
            <view class="action-btn small danger" bindtap="onDelete" data-id="{{item.id}}">
              <text class="btn-icon">ğŸ—‘ï¸</text>
            </view>
          </view>
        </view>
        
        <view class="mistake-content">
          <view class="mistake-text">{{item.question}}</view>
          <view class="mistake-answers">
            <view class="answer-item wrong">
              <text class="answer-label">ä½ çš„ç­”æ¡ˆï¼š</text>
              <text class="answer-text">{{item.userAnswer}}</text>
            </view>
            <view class="answer-item correct">
              <text class="answer-label">æ­£ç¡®ç­”æ¡ˆï¼š</text>
              <text class="answer-text">{{item.correctAnswer}}</text>
            </view>
          </view>
          
          <view class="mistake-analysis" wx:if="{{item.analysis}}">
            <text class="analysis-label">è§£æï¼š</text>
            <text class="analysis-text">{{item.analysis}}</text>
          </view>
          
          <view class="mistake-meta">
            <view class="meta-item">
              <text class="meta-label">é”™è¯¯æ¬¡æ•°ï¼š</text>
              <text class="meta-value">{{item.errorCount || 1}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-label">æ­£ç¡®æ¬¡æ•°ï¼š</text>
              <text class="meta-value">{{item.correctCount || 0}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-label">æ—¥æœŸï¼š</text>
              <text class="meta-value">{{item.date}}</text>
            </view>
          </view>
          
          <!-- æ¶ˆç­è¿›åº¦æ¡ -->
          <view class="elimination-progress">
            <view class="progress-header">
              <text class="progress-label">æ¶ˆç­è¿›åº¦</text>
              <text class="progress-text">
                {{item.correctCount || 0}}/{{autoRemoveConfig.correctCount}} 
                (è¿˜éœ€{{autoRemoveConfig.correctCount - (item.correctCount || 0)}}æ¬¡)
              </text>
            </view>
            <view class="progress-bar">
              <view class="progress-fill" style="width: {{((item.correctCount || 0) / autoRemoveConfig.correctCount * 100)}}%"></view>
            </view>
          </view>
        </view>
      </view>
    </block>
    
    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredMistakes.length === 0}}">
      <text class="empty-text">æš‚æ— é”™é¢˜è®°å½•</text>
      <text class="empty-desc">ç»§ç»­ç»ƒä¹ ï¼Œé”™é¢˜ä¼šè‡ªåŠ¨æ”¶é›†åˆ°è¿™é‡Œ</text>
    </view>
  </view>
</view> 