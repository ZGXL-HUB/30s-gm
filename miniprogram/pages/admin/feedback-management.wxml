<!--ç®¡ç†å‘˜åé¦ˆç®¡ç†é¡µé¢-->
<view class="container">
  <view class="header">
    <view class="header-title">åé¦ˆç®¡ç†</view>
    <view class="header-desc">å¤„ç†ç”¨æˆ·åé¦ˆå’Œé—®é¢˜</view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-section">
    <view class="stats-card">
      <view class="stats-number">{{stats.total}}</view>
      <view class="stats-label">æ€»åé¦ˆ</view>
    </view>
    <view class="stats-card pending">
      <view class="stats-number">{{stats.pending}}</view>
      <view class="stats-label">å¾…å¤„ç†</view>
    </view>
    <view class="stats-card processing">
      <view class="stats-number">{{stats.processing}}</view>
      <view class="stats-label">å¤„ç†ä¸­</view>
    </view>
    <view class="stats-card resolved">
      <view class="stats-number">{{stats.resolved}}</view>
      <view class="stats-label">å·²è§£å†³</view>
    </view>
  </view>

  <!-- ç­›é€‰å™¨ -->
  <view class="filter-section">
    <view class="filter-item">
      <text class="filter-label">çŠ¶æ€ï¼š</text>
      <picker bindchange="onStatusChange" value="{{statusIndex}}" range="{{statusOptions}}">
        <view class="picker-text">{{statusOptions[statusIndex]}}</view>
      </picker>
    </view>
    <view class="filter-item">
      <text class="filter-label">ä¼˜å…ˆçº§ï¼š</text>
      <picker bindchange="onPriorityChange" value="{{priorityIndex}}" range="{{priorityOptions}}">
        <view class="picker-text">{{priorityOptions[priorityIndex]}}</view>
      </picker>
    </view>
  </view>

  <!-- åé¦ˆåˆ—è¡¨ -->
  <view class="feedback-list" wx:if="{{feedbackList.length > 0}}">
    <view 
      class="feedback-item priority-{{item.priority}}"
      wx:for="{{feedbackList}}"
      wx:key="feedbackId"
      bindtap="viewFeedbackDetail"
      data-feedback="{{item}}"
    >
      <view class="feedback-header">
        <view class="feedback-title">{{item.title}}</view>
        <view class="feedback-status status-{{item.status}}">
          {{item.statusText}}
        </view>
      </view>
      
      <view class="feedback-content">{{item.content}}</view>
      
      <view class="feedback-meta">
        <view class="feedback-time">{{item.createTimeText}}</view>
        <view class="feedback-type">{{item.typeText}}</view>
        <view class="feedback-priority">ä¼˜å…ˆçº§: {{item.priority}}</view>
      </view>
      
      <view class="feedback-actions">
        <button 
          class="action-btn primary" 
          bindtap="updateStatus" 
          data-feedback-id="{{item.feedbackId}}"
          data-action="processing"
          wx:if="{{item.status === 'pending'}}"
        >
          å¼€å§‹å¤„ç†
        </button>
        <button 
          class="action-btn success" 
          bindtap="updateStatus" 
          data-feedback-id="{{item.feedbackId}}"
          data-action="resolved"
          wx:if="{{item.status === 'processing'}}"
        >
          æ ‡è®°è§£å†³
        </button>
        <button 
          class="action-btn secondary" 
          bindtap="replyFeedback" 
          data-feedback-id="{{item.feedbackId}}"
        >
          å›å¤
        </button>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{feedbackList.length === 0 && !loading}}">
    <view class="empty-icon">ğŸ“</view>
    <view class="empty-title">æš‚æ— åé¦ˆ</view>
    <view class="empty-desc">å½“å‰ç­›é€‰æ¡ä»¶ä¸‹æ²¡æœ‰åé¦ˆè®°å½•</view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>

  <!-- åé¦ˆè¯¦æƒ…æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showDetailModal}}" bindtap="hideDetailModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <view class="modal-title">åé¦ˆè¯¦æƒ…</view>
        <view class="modal-close" bindtap="hideDetailModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="detail-section">
          <view class="detail-label">åé¦ˆç±»å‹</view>
          <view class="detail-value">{{selectedFeedback.typeText}}</view>
        </view>
        
        <view class="detail-section">
          <view class="detail-label">ä¼˜å…ˆçº§</view>
          <view class="detail-value priority-{{selectedFeedback.priority}}">
            {{selectedFeedback.priority}} ({{selectedFeedback.urgencyText}})
          </view>
        </view>
        
        <view class="detail-section">
          <view class="detail-label">åé¦ˆå†…å®¹</view>
          <view class="detail-value">{{selectedFeedback.content}}</view>
        </view>
        
        <view class="detail-section" wx:if="{{selectedFeedback.contact}}">
          <view class="detail-label">è”ç³»æ–¹å¼</view>
          <view class="detail-value">{{selectedFeedback.contact}}</view>
        </view>
        
        <view class="detail-section">
          <view class="detail-label">æäº¤æ—¶é—´</view>
          <view class="detail-value">{{selectedFeedback.createTimeText}}</view>
        </view>
        
        <view class="detail-section">
          <view class="detail-label">å¤„ç†çŠ¶æ€</view>
          <view class="detail-value status-{{selectedFeedback.status}}">
            {{selectedFeedback.statusText}}
          </view>
        </view>
        
        <view class="detail-section" wx:if="{{selectedFeedback.keywords && selectedFeedback.keywords.length > 0}}">
          <view class="detail-label">å…³é”®è¯</view>
          <view class="detail-value">
            <text class="keyword-tag" wx:for="{{selectedFeedback.keywords}}" wx:key="index">
              {{item}}
            </text>
          </view>
        </view>
        
        <view class="detail-section" wx:if="{{selectedFeedback.reply}}">
          <view class="detail-label">å›å¤å†…å®¹</view>
          <view class="detail-value reply-content">{{selectedFeedback.reply}}</view>
        </view>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn secondary" bindtap="hideDetailModal">å…³é—­</button>
        <button class="modal-btn primary" bindtap="replyFeedback" data-feedback-id="{{selectedFeedback.feedbackId}}">
          å›å¤ç”¨æˆ·
        </button>
      </view>
    </view>
  </view>

  <!-- å›å¤æ¨¡æ€æ¡† -->
  <view class="modal-overlay" wx:if="{{showReplyModal}}" bindtap="hideReplyModal">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <view class="modal-title">å›å¤ç”¨æˆ·</view>
        <view class="modal-close" bindtap="hideReplyModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <textarea 
          class="reply-textarea"
          placeholder="è¯·è¾“å…¥å›å¤å†…å®¹..."
          value="{{replyContent}}"
          bindinput="onReplyInput"
          maxlength="500"
        ></textarea>
        <view class="char-count">{{replyContent.length}}/500</view>
      </view>
      
      <view class="modal-actions">
        <button class="modal-btn secondary" bindtap="hideReplyModal">å–æ¶ˆ</button>
        <button class="modal-btn primary" bindtap="submitReply">å‘é€å›å¤</button>
      </view>
    </view>
  </view>
</view>
