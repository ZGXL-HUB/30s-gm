<!--å®Œæ•´çš„æ•™å¸ˆç«¯ç­çº§ç®¡ç†é¡µé¢æ¨¡æ¿-->
<view class="teacher-class">
  <!-- æ ‡ç­¾é¡µå¯¼èˆª -->
  <view class="tab-nav">
    <view 
      class="tab-item {{currentTab === 'classes' ? 'active' : ''}}"
      data-tab="classes"
      bindtap="switchTab"
    >ç­çº§åˆ—è¡¨</view>
    <view 
      class="tab-item {{currentTab === 'students' ? 'active' : ''}}"
      data-tab="students"
      bindtap="switchTab"
    >å­¦ç”Ÿç®¡ç†</view>
  </view>

  <!-- ç­çº§åˆ—è¡¨ -->
  <view class="tab-content" wx:if="{{currentTab === 'classes'}}">
    <view class="section-header">
      <text class="title">æˆ‘çš„ç­çº§</text>
      <view class="header-actions">
        <button class="btn btn-secondary" bindtap="refreshClassList">
          <text class="btn-icon">ğŸ”„</text>
          åˆ·æ–°ç­çº§
        </button>
        <button class="btn btn-primary" bindtap="showCreateClassModal">åˆ›å»ºç­çº§</button>
      </view>
    </view>
    
    <view class="classes-list">
      <view 
        class="class-item"
        wx:for="{{classes}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="viewClassDetail"
      >
        <view class="class-info">
          <view class="class-header">
            <text class="name">{{item.name}}</text>
            <view class="status-badge status-{{item.status}}">
              {{item.status === 'active' ? 'æ´»è·ƒ' : 'åœç”¨'}}
            </view>
          </view>
          <text class="teacher">{{item.teacher}}</text>
          <text class="time">æœ€åæ´»åŠ¨: {{formatTime(item.lastActivity)}}</text>
        </view>
        
        <view class="class-stats">
          <view class="stat-item">
            <text class="number">{{item.studentCount}}</text>
            <text class="label">å­¦ç”Ÿ</text>
          </view>
          <view class="stat-item">
            <text class="number">{{item.averageAccuracy}}%</text>
            <text class="label">å¹³å‡æ­£ç¡®ç‡</text>
          </view>
          <view class="stat-item">
            <text class="number">{{item.completedAssignments}}/{{item.totalAssignments}}</text>
            <text class="label">å®Œæˆä½œä¸š</text>
          </view>
        </view>
        
        <view class="class-actions">
          <!-- å¤åˆ¶å¹¶åˆ†äº«é‚€è¯·ç æŒ‰é’® -->
          <button class="btn btn-primary" data-class-id="{{item.id}}" bindtap="copyAndShareInvite" catchtap="copyAndShareInvite">å¤åˆ¶å¹¶åˆ†äº«é‚€è¯·ç </button>
          
          <!-- ç”³è¯·è§£æ•£ç­çº§æŒ‰é’® -->
          <button class="btn btn-warning" data-class-id="{{item.id}}" data-class-name="{{item.name}}" bindtap="requestDismissClass" catchtap="requestDismissClass">ç”³è¯·è§£æ•£ç­çº§</button>
        </view>
        
        <!-- é‚€è¯·ç ä¿¡æ¯æ˜¾ç¤º -->
        <view class="invite-info" wx:if="{{item.inviteCode}}">
          <view class="invite-code-display">
            <text class="invite-label">é‚€è¯·ç :</text>
            <text class="invite-code">{{item.inviteCode}}</text>
            <button class="btn-copy" data-code="{{item.inviteCode}}" bindtap="copyInviteCode" catchtap="copyInviteCode">å¤åˆ¶</button>
          </view>
          <text class="invite-expiry">æœ‰æ•ˆæœŸè‡³: {{formatDate(item.inviteCodeExpiry)}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å­¦ç”Ÿç®¡ç† -->
  <view class="tab-content" wx:if="{{currentTab === 'students'}}">
    <view class="section-header">
      <text class="title">å­¦ç”Ÿç®¡ç†</text>
      <view class="header-actions">
        <button class="btn btn-outline" bindtap="showUsageGuide">ä½¿ç”¨è¯´æ˜</button>
        <button class="btn btn-secondary btn-refresh" bindtap="refreshStudentList">
          <text class="btn-icon">ğŸ”„</text>
          åˆ·æ–°
        </button>
      </view>
    </view>
    
    <!-- å­¦ç”Ÿç»Ÿè®¡ä¿¡æ¯ -->
    <view class="students-stats">
      <text class="stats-text">å…± {{students.length}} åå­¦ç”Ÿ</text>
    </view>

    <!-- å­¦ç”Ÿåˆ—è¡¨ -->
    <view class="students-list">
      <view 
        class="student-card"
        wx:for="{{students}}" 
        wx:key="id"
        data-id="{{item.id}}"
        bindtap="viewStudentDetail"
      >
        <!-- å­¦ç”ŸåŸºæœ¬ä¿¡æ¯ -->
        <view class="student-header">
          <view class="student-info">
            <text class="student-name">{{item.name}}</text>
            <text class="student-id">{{item.studentId}}</text>
          </view>
          <view class="status-badge status-{{item.status}}">
            {{item.status === 'active' ? 'æ´»è·ƒ' : 'ç¦»çº¿'}}
          </view>
        </view>

        <!-- ç­çº§ä¿¡æ¯ -->
        <view class="student-class">
          <text class="class-label">ç­çº§ï¼š</text>
          <text class="class-name">{{item.class}}</text>
        </view>

        <!-- è”ç³»æ–¹å¼ -->
        <view class="student-contact" wx:if="{{item.phone || item.email}}">
          <text class="contact-text">{{item.phone}} {{item.email}}</text>
        </view>

        <!-- å­¦ä¹ ç»Ÿè®¡ -->
        <view class="student-stats">
          <view class="stat-item">
            <text class="stat-number">{{item.completedAssignments}}/{{item.totalAssignments}}</text>
            <text class="stat-label">å®Œæˆä½œä¸š</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{item.averageAccuracy}}%</text>
            <text class="stat-label">å¹³å‡æ­£ç¡®ç‡</text>
          </view>
          <view class="stat-item">
            <text class="stat-number">{{item.weakGrammarPoints.length}}</text>
            <text class="stat-label">è–„å¼±ç‚¹</text>
          </view>
        </view>

        <!-- è–„å¼±è¯­æ³•ç‚¹ -->
        <view class="weak-points" wx:if="{{item.weakGrammarPoints.length > 0}}">
          <text class="weak-points-label">è–„å¼±è¯­æ³•ç‚¹ï¼š</text>
          <view class="points-list">
            <text 
              class="point-tag"
              wx:for="{{item.weakGrammarPoints}}" 
              wx:key="*this"
            >{{item}}</text>
          </view>
        </view>

      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{students.length === 0}}">
      <text class="empty-icon">ğŸ‘¥</text>
      <text class="empty-text">æš‚æ— å­¦ç”Ÿæ•°æ®</text>
      <text class="empty-tip">ç‚¹å‡»"æ·»åŠ å­¦ç”Ÿ"æŒ‰é’®æ·»åŠ æ–°å­¦ç”Ÿ</text>
    </view>

  </view>

  <!-- åˆ›å»ºç­çº§å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showCreateClass}}">
    <view class="modal create-class-modal">
      <view class="modal-header">
        <text class="modal-title">åˆ›å»ºç­çº§</text>
        <text class="modal-close" bindtap="closeCreateClassModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <!-- ç­çº§åç§° -->
        <view class="form-item">
          <text class="form-label">ç­çº§åç§°</text>
          <input 
            class="form-input"
            type="text" 
            placeholder="è¯·è¾“å…¥ç­çº§åç§°"
            value="{{newClass.name}}"
            data-field="name"
            bindinput="onClassInput"
          />
        </view>
        
        <!-- ç­çº§ç±»å‹æ ‡ç­¾ -->
        <view class="form-item">
          <text class="form-label">ç­çº§ç±»å‹</text>
          <view class="tag-group">
            <view 
              class="tag {{newClass.classType === 'é«˜è€ƒæ–‡åŒ–ç­' ? 'active' : ''}}"
              data-type="é«˜è€ƒæ–‡åŒ–ç­"
              bindtap="selectClassType"
            >é«˜è€ƒæ–‡åŒ–ç­</view>
            <view 
              class="tag {{newClass.classType === 'ç‰¹é•¿ç­' ? 'active' : ''}}"
              data-type="ç‰¹é•¿ç­"
              bindtap="selectClassType"
            >ç‰¹é•¿ç­</view>
            <view 
              class="tag {{newClass.classType === 'å•æ‹›ç­' ? 'active' : ''}}"
              data-type="å•æ‹›ç­"
              bindtap="selectClassType"
            >å•æ‹›ç­</view>
          </view>
        </view>
        
        <!-- å­¦æœŸæ ‡ç­¾ -->
        <view class="form-item">
          <text class="form-label">å­¦æœŸ</text>
          <view class="tag-group semester-tags">
            <view 
              class="tag {{newClass.semester === 'é«˜ä¸€ä¸Š' ? 'active' : ''}}"
              data-semester="é«˜ä¸€ä¸Š"
              bindtap="selectSemester"
            >é«˜ä¸€ä¸Š</view>
            <view 
              class="tag {{newClass.semester === 'é«˜ä¸€ä¸‹' ? 'active' : ''}}"
              data-semester="é«˜ä¸€ä¸‹"
              bindtap="selectSemester"
            >é«˜ä¸€ä¸‹</view>
            <view 
              class="tag {{newClass.semester === 'é«˜äºŒä¸Š' ? 'active' : ''}}"
              data-semester="é«˜äºŒä¸Š"
              bindtap="selectSemester"
            >é«˜äºŒä¸Š</view>
            <view 
              class="tag {{newClass.semester === 'é«˜äºŒä¸‹' ? 'active' : ''}}"
              data-semester="é«˜äºŒä¸‹"
              bindtap="selectSemester"
            >é«˜äºŒä¸‹</view>
            <view 
              class="tag {{newClass.semester === 'é«˜ä¸‰ä¸Š' ? 'active' : ''}}"
              data-semester="é«˜ä¸‰ä¸Š"
              bindtap="selectSemester"
            >é«˜ä¸‰ä¸Š</view>
            <view 
              class="tag {{newClass.semester === 'é«˜ä¸‰ä¸‹' ? 'active' : ''}}"
              data-semester="é«˜ä¸‰ä¸‹"
              bindtap="selectSemester"
            >é«˜ä¸‰ä¸‹</view>
          </view>
        </view>
        
        <!-- ã€å·²éšè—ã€‘Excelå¯¼å…¥å­¦ç”Ÿåå•åŠŸèƒ½ - é¿å…ä¸é‚€è¯·ç åŠ å…¥åŠŸèƒ½å†²çªï¼Œæ¨èä½¿ç”¨é‚€è¯·ç æ–¹å¼è®©å­¦ç”Ÿè‡ªä¸»åŠ å…¥ç­çº§ï¼Œå‡å°‘æ•™å¸ˆæ‰‹åŠ¨å¯¼å…¥å·¥ä½œé‡ -->
        <!-- 
        <view class="form-item">
          <text class="form-label">å¯¼å…¥å­¦ç”Ÿåå•ï¼ˆå¯é€‰ï¼‰</text>
          <view class="excel-upload-area" bindtap="uploadExcelForNewClass">
            <view class="upload-icon">ğŸ“Š</view>
            <text class="upload-text">ç‚¹å‡»ä¸Šä¼ Excelæ–‡ä»¶</text>
            <text class="upload-hint">æ”¯æŒ.xlsxæ ¼å¼ï¼ŒåŒ…å«å­¦ç”Ÿå§“ååˆ—</text>
          </view>
          <view class="uploaded-file" wx:if="{{newClass.excelFile}}">
            <text class="file-name">ğŸ“„ {{newClass.excelFile.name}}</text>
            <text class="file-remove" bindtap="removeExcelFile">åˆ é™¤</text>
          </view>
        </view>
        -->
        
        <!-- ğŸ’¡ æç¤ºï¼šæ¨èä½¿ç”¨é‚€è¯·ç æ–¹å¼ -->
        <view class="form-item">
          <view class="invite-tip-box">
            <text class="tip-icon">ğŸ’¡</text>
            <view class="tip-content">
              <text class="tip-title">æ¨èä½¿ç”¨é‚€è¯·ç æ–¹å¼</text>
              <text class="tip-text">åˆ›å»ºç­çº§åï¼Œå°†é‚€è¯·ç åˆ†äº«ç»™å­¦ç”Ÿï¼Œå­¦ç”Ÿæ‰«ç å³å¯è‡ªåŠ¨åŠ å…¥ç­çº§</text>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="closeCreateClassModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="createClass" loading="{{loading}}">åˆ›å»º</button>
      </view>
    </view>
  </view>

  <!-- åˆ›å»ºå­¦ç”Ÿå¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showCreateStudent}}">
    <view class="modal">
      <view class="modal-header">
        <text class="modal-title">æ·»åŠ å­¦ç”Ÿ</text>
        <text class="modal-close" bindtap="closeCreateStudentModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">å­¦ç”Ÿå§“å</text>
          <input 
            class="form-input"
            type="text" 
            placeholder="è¯·è¾“å…¥å­¦ç”Ÿå§“å"
            value="{{newStudent.name}}"
            data-field="name"
            bindinput="onStudentInput"
          />
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="closeCreateStudentModal">å–æ¶ˆ</button>
        <button class="btn btn-primary" bindtap="createStudent">åˆ›å»º</button>
      </view>
    </view>
  </view>

  <!-- ç­çº§è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showClassDetail}}">
    <view class="modal">
      <view class="modal-header">
        <text class="modal-title">ç­çº§å­¦ç”Ÿåå•</text>
        <text class="modal-close" bindtap="closeClassDetail">Ã—</text>
      </view>
      
      <view class="modal-body" wx:if="{{selectedClass}}">
        <view class="class-info-header">
          <text class="class-name">{{selectedClass.name}}</text>
          <text class="student-count">å…±{{selectedClass.studentCount}}äºº</text>
        </view>
        
        <view class="students-list" wx:if="{{classStudents.length > 0}}">
          <view 
            class="student-item"
            wx:for="{{classStudents}}" 
            wx:key="id"
          >
            <view class="student-info">
              <text class="student-name">{{item.name}}</text>
              <text class="student-id" wx:if="{{item.studentId}}">å­¦å·: {{item.studentId}}</text>
            </view>
            <view class="student-status">
              <text class="status-text">{{item.status === 'active' ? 'æ´»è·ƒ' : 'ç¦»çº¿'}}</text>
            </view>
          </view>
        </view>
        
        <view class="empty-students" wx:else>
          <text class="empty-text">è¯¥ç­çº§æš‚æ— å­¦ç”Ÿ</text>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" data-classid="{{selectedClass.id}}" bindtap="showManualStudentInput">
          <text class="btn-icon">âœï¸</text>
          æ‰‹åŠ¨è¾“å…¥å­¦ç”Ÿ
        </button>
        <button class="btn btn-primary" bindtap="closeClassDetail">å…³é—­</button>
      </view>
    </view>
  </view>

  <!-- æ‰‹åŠ¨è¾“å…¥å­¦ç”Ÿå§“åå¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showManualInput}}">
    <view class="modal manual-input-modal">
      <view class="modal-header">
        <text class="modal-title">æ‰‹åŠ¨è¾“å…¥å­¦ç”Ÿå§“å</text>
        <text class="modal-close" bindtap="closeManualStudentInput">Ã—</text>
      </view>
      
      <view class="modal-body">
        <!-- æ ¼å¼åˆ‡æ¢ -->
        <view class="format-switcher">
          <view class="format-options">
            <view 
              class="format-option {{inputFormat === 'nameOnly' ? 'active' : ''}}"
              data-format="nameOnly"
              bindtap="switchInputFormat"
            >
              <text class="format-icon">ğŸ‘¤</text>
              <text class="format-text">ä»…å§“å</text>
              <text class="format-desc">è‡ªåŠ¨ç”Ÿæˆå­¦å·</text>
            </view>
            <view 
              class="format-option {{inputFormat === 'nameAndId' ? 'active' : ''}}"
              data-format="nameAndId"
              bindtap="switchInputFormat"
            >
              <text class="format-icon">ğŸ‘¤ğŸ“</text>
              <text class="format-text">å§“å+å­¦å·</text>
              <text class="format-desc">æ‰‹åŠ¨è¾“å…¥å­¦å·</text>
            </view>
          </view>
        </view>
        
        <!-- è¾“å…¥æç¤º -->
        <view class="input-tip">
          <text class="tip-text">ğŸ“ {{inputFormat === 'nameOnly' ? 'è¯·è¾“å…¥å­¦ç”Ÿå§“åï¼Œæ¯è¡Œä¸€ä¸ª' : 'è¯·è¾“å…¥å­¦ç”Ÿå§“åå’Œå­¦å·ï¼Œæ ¼å¼ï¼šå§“å å­¦å·'}}</text>
          <text class="tip-example" wx:if="{{inputFormat === 'nameOnly'}}">ä¾‹å¦‚ï¼š
å¼ å°æ˜
æå°çº¢
ç‹å°å</text>
          <text class="tip-example" wx:else>ä¾‹å¦‚ï¼š
å¼ å°æ˜ 2024001
æå°çº¢ 2024002
ç‹å°å 2024003</text>
        </view>
        
        <!-- è¾“å…¥åŒºåŸŸ -->
        <view class="input-area">
          <textarea 
            class="student-input"
            placeholder="{{inputPlaceholder}}"
            value="{{manualInputText}}"
            bindinput="onManualInputChange"
            auto-height
            maxlength="2000"
            show-confirm-bar="{{false}}"
          ></textarea>
        </view>
        
        <!-- æ“ä½œæŒ‰é’® -->
        <view class="input-actions">
          <button class="btn btn-secondary" bindtap="pasteFromClipboard">
            <text class="btn-icon">ğŸ“‹</text>
            ä»å‰ªè´´æ¿ç²˜è´´
          </button>
          <button class="btn btn-primary" bindtap="parseManualStudents">
            <text class="btn-icon">âœ“</text>
            è§£æå­¦ç”Ÿåå•
          </button>
        </view>
        
        <!-- é¢„è§ˆåŒºåŸŸ -->
        <view class="preview-area" wx:if="{{manualStudents.length > 0}}">
          <text class="preview-title">å·²è§£æ {{manualStudents.length}} ä¸ªå­¦ç”Ÿï¼š</text>
          <view class="student-preview">
            <view 
              class="student-preview-item"
              wx:for="{{manualStudents}}"
              wx:key="rowIndex"
            >
              <view class="student-info">
                <text class="student-index">{{item.rowIndex}}.</text>
                <text class="student-name">{{item.name}}</text>
                <text class="student-id" wx:if="{{inputFormat === 'nameAndId'}}">({{item.studentId}})</text>
                <text class="student-id auto" wx:else>(è‡ªåŠ¨ç”Ÿæˆ)</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-secondary" bindtap="closeManualStudentInput">å–æ¶ˆ</button>
      </view>
    </view>
  </view>

  <!-- å­¦ç”Ÿè¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showStudentDetail}}">
    <view class="modal">
      <view class="modal-header">
        <text class="modal-title">å­¦ç”Ÿè¯¦æƒ…</text>
        <text class="modal-close" bindtap="closeStudentDetail">Ã—</text>
      </view>
      
      <view class="modal-body" wx:if="{{selectedStudent}}">
        <view class="detail-section">
          <text class="detail-title">åŸºæœ¬ä¿¡æ¯</text>
          <view class="detail-item">
            <text class="detail-label">å§“åï¼š</text>
            <text class="detail-value">{{selectedStudent.name}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">å­¦å·ï¼š</text>
            <text class="detail-value">{{selectedStudent.studentId}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">ç­çº§ï¼š</text>
            <text class="detail-value">{{selectedStudent.class}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">çŠ¶æ€ï¼š</text>
            <text class="detail-value">{{selectedStudent.status === 'active' ? 'æ´»è·ƒ' : 'ç¦»çº¿'}}</text>
          </view>
        </view>

        <view class="detail-section">
          <text class="detail-title">å­¦ä¹ ç»Ÿè®¡</text>
          <view class="detail-item">
            <text class="detail-label">å®Œæˆä½œä¸šï¼š</text>
            <text class="detail-value">{{selectedStudent.completedAssignments}}/{{selectedStudent.totalAssignments}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">å¹³å‡æ­£ç¡®ç‡ï¼š</text>
            <text class="detail-value">{{selectedStudent.averageAccuracy}}%</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">è–„å¼±ç‚¹æ•°é‡ï¼š</text>
            <text class="detail-value">{{selectedStudent.weakGrammarPoints.length}}ä¸ª</text>
          </view>
        </view>

        <view class="detail-section" wx:if="{{selectedStudent.weakGrammarPoints.length > 0}}">
          <text class="detail-title">è–„å¼±è¯­æ³•ç‚¹</text>
          <view class="weak-points-detail">
            <text 
              class="weak-point-detail"
              wx:for="{{selectedStudent.weakGrammarPoints}}" 
              wx:key="*this"
            >{{item}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-primary" bindtap="closeStudentDetail">å…³é—­</button>
      </view>
    </view>
  </view>

  <!-- åˆ†äº«å›¾ç‰‡å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showShareImageModal}}">
    <view class="modal share-image-modal">
      <view class="modal-header">
        <text class="modal-title">ç­çº§é‚€è¯·ç </text>
        <text class="modal-close" bindtap="closeShareImageModal">Ã—</text>
      </view>
      
      <view class="modal-body">
        <image class="share-image" src="{{shareImageUrl}}" mode="widthFix" wx:if="{{shareImageUrl}}"></image>
      </view>
      
      <view class="modal-footer">
        <button class="btn btn-primary" bindtap="closeShareImageModal">å…³é—­</button>
      </view>
    </view>
  </view>

</view>