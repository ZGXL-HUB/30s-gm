<!--æ•™å¸ˆç«¯å¸ƒç½®è¯­æ³•ä½œä¸šé¡µé¢ï¼ˆåˆä¸­ç‰ˆï¼‰-->
<view class="teacher-homework">
  <!-- ä½œä¸šç±»å‹é€‰æ‹©å¡ç‰‡å¼¹çª— -->
  <view class="homework-type-selector" wx:if="{{!homeworkType}}">
    <view class="selector-header">
      <text class="title">é€‰æ‹©ä½œä¸šç±»å‹</text>
      <text class="subtitle">è¯·é€‰æ‹©æ‚¨è¦å¸ƒç½®çš„ä½œä¸šç±»å‹ï¼ˆåˆä¸­ï¼‰</text>
    </view>
    <view class="type-cards">
      <view 
        class="type-card"
        wx:for="{{homeworkTypes}}" 
        wx:key="id"
        data-type="{{item.id}}"
        bindtap="selectHomeworkType"
      >
        <view class="card-icon" style="background: linear-gradient(135deg, {{item.color}} 0%, {{item.color}}CC 100%);">
          <text class="icon">{{item.icon}}</text>
        </view>
        <view class="card-content">
          <text class="title">{{item.title}}</text>
          <text class="subtitle">{{item.subtitle}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»Ÿä¸€æ–‡ä»¶æ ‘ç•Œé¢ -->
  <view class="homework-content" wx:if="{{homeworkType}}">
    <!-- è€ƒæƒ…åˆ†æå±•ç¤ºï¼ˆä»…åœ¨ä¸­è€ƒé…æ¯”æ¨¡å¼æ˜¾ç¤ºï¼‰ -->
    <view class="exam-analysis-section" wx:if="{{homeworkType === 'zhongkao'}}">
      <view class="analysis-header">
        <text class="analysis-title">ğŸ“Š è€ƒæƒ…åˆ†æ</text>
        <text class="analysis-subtitle">åŸºäºäº‘å—2023-2025å¹´ä¸­è€ƒçœŸé¢˜</text>
      </view>
      <view class="analysis-items">
        <view class="analysis-item" wx:for="{{examAnalysis.categories}}" wx:key="name">
          <text class="analysis-name">{{item.name}}:</text>
          <text class="analysis-percentage">{{item.percentage}}%</text>
          <text class="analysis-frequency">{{item.frequency}}</text>
        </view>
      </view>
    </view>

    <!-- é¡¶éƒ¨å·²é€‰å†…å®¹æ ‡ç­¾ -->
    <view class="selected-content-header">
      <view class="header-row">
        <text class="header-title">å·²é€‰å†…å®¹</text>
        <!-- ä¹±åºå¼€å…³ -->
        <view class="shuffle-toggle">
          <text class="shuffle-label">ä¹±åºå‡ºé¢˜</text>
          <switch 
            checked="{{shuffleQuestions}}" 
            bindchange="toggleShuffle"
            color="#1890ff"
          />
        </view>
      </view>
      <!-- ä¸“é¢˜æ¨¡å¼ï¼šåŒé¢˜å‹æ§åˆ¶ -->
      <view class="topic-mode-control" wx:if="{{homeworkType === 'topic-middle'}}">
        <view class="type-control-section">
          <text class="type-control-label">é€‰æ‹©é¢˜æ•°é‡:</text>
          <view class="type-control-buttons">
            <text 
              class="type-control-btn {{topicModeTypeControl.choice.current === item ? 'active' : ''}}"
              wx:for="{{topicModeTypeControl.choice.options}}" 
              wx:key="*this"
              data-count="{{item}}"
              bindtap="switchTopicChoiceCount"
            >{{item}}</text>
          </view>
        </view>
        <view class="type-control-section">
          <text class="type-control-label">å¡«ç©ºé¢˜æ•°é‡:</text>
          <view class="type-control-buttons">
            <text 
              class="type-control-btn {{topicModeTypeControl.fill.current === item ? 'active' : ''}}"
              wx:for="{{topicModeTypeControl.fill.options}}" 
              wx:key="*this"
              data-count="{{item}}"
              bindtap="switchTopicFillCount"
            >{{item}}</text>
          </view>
        </view>
        <view class="total-info-section">
          <text class="total-label">æ€»é¢˜æ•°:</text>
          <text class="total-count">{{totalQuestions}}é¢˜</text>
          <text class="type-breakdown">(é€‰æ‹©{{totalChoiceQuestions}}+å¡«ç©º{{totalFillQuestions}})</text>
        </view>
        
        <!-- çŸ¥è¯†ç‚¹åˆ†é…æ˜¾ç¤ºï¼ˆå¦‚æœå·²é€‰ä¸“é¢˜ï¼‰ -->
        <view class="point-distribution" wx:if="{{selectedTopics.length > 0 && topicPointsList.length > 0}}">
          <text class="distribution-title">çŸ¥è¯†ç‚¹åˆ†é…ï¼ˆå¯å¾®è°ƒï¼‰:</text>
          <view class="distribution-items">
            <view 
              class="distribution-point-item"
              wx:for="{{topicPointsList}}" 
              wx:key="id"
            >
              <text class="point-name">{{item.name}}</text>
              <view class="point-type-controls">
                <view class="type-control-group choice-group">
                  <text class="type-label choice-label">é€‰æ‹©:</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="choice" data-delta="-1" bindtap="adjustPointTypeCount">âˆ’</text>
                  <text class="type-count">{{item.choiceCount || 0}}</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="choice" data-delta="1" bindtap="adjustPointTypeCount">+</text>
                </view>
                <view class="type-control-group fill-group">
                  <text class="type-label fill-label">å¡«ç©º:</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="fill" data-delta="-1" bindtap="adjustPointTypeCount">âˆ’</text>
                  <text class="type-count">{{item.fillCount || 0}}</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="fill" data-delta="1" bindtap="adjustPointTypeCount">+</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="selected-tags" wx:if="{{homeworkType === 'custom-middle'}}">
        <!-- è‡ªé€‰æ¨¡å¼ï¼šåŒé¢˜å‹æ§åˆ¶ -->
        <view class="custom-mode-control">
          <view class="type-control-section">
            <text class="type-control-label">é€‰æ‹©é¢˜æ•°é‡:</text>
            <view class="type-control-buttons">
              <text 
                class="type-control-btn {{customModeTypeControl.choice.current === item ? 'active' : ''}}"
                wx:for="{{customModeTypeControl.choice.options}}" 
                wx:key="*this"
                data-count="{{item}}"
                bindtap="switchCustomChoiceCount"
              >{{item}}</text>
            </view>
          </view>
          <view class="type-control-section">
            <text class="type-control-label">å¡«ç©ºé¢˜æ•°é‡:</text>
            <view class="type-control-buttons">
              <text 
                class="type-control-btn {{customModeTypeControl.fill.current === item ? 'active' : ''}}"
                wx:for="{{customModeTypeControl.fill.options}}" 
                wx:key="*this"
                data-count="{{item}}"
                bindtap="switchCustomFillCount"
              >{{item}}</text>
            </view>
          </view>
          <view class="total-info-section">
            <text class="total-label">æ€»é¢˜æ•°:</text>
            <text class="total-count">{{totalQuestions}}é¢˜</text>
            <text class="type-breakdown">(é€‰æ‹©{{totalChoiceQuestions}}+å¡«ç©º{{totalFillQuestions}})</text>
          </view>
        </view>
        
        
        <!-- è‡ªé€‰æ¨¡å¼ï¼šçŸ¥è¯†ç‚¹é¢˜å‹åˆ†é… -->
        <view class="point-type-distribution" wx:if="{{homeworkType === 'custom-middle' && selectedTags.length > 0}}">
          <text class="distribution-title">çŸ¥è¯†ç‚¹åˆ†é…ï¼ˆå¯å¾®è°ƒï¼‰:</text>
          <view class="distribution-items">
            <view 
              class="distribution-point-item"
              wx:for="{{selectedTags}}" 
              wx:key="id"
            >
              <text class="point-name">{{item.name}}</text>
              <view class="point-type-controls">
                <view class="type-control-group choice-group">
                  <text class="type-label choice-label">é€‰æ‹©:</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="choice" data-delta="-1" bindtap="adjustPointTypeCount">âˆ’</text>
                  <text class="type-count">{{item.choiceCount || 0}}</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="choice" data-delta="1" bindtap="adjustPointTypeCount">+</text>
                </view>
                <view class="type-control-group fill-group">
                  <text class="type-label fill-label">å¡«ç©º:</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="fill" data-delta="-1" bindtap="adjustPointTypeCount">âˆ’</text>
                  <text class="type-count">{{item.fillCount || 0}}</text>
                  <text class="type-btn" data-point-id="{{item.name}}" data-type="fill" data-delta="1" bindtap="adjustPointTypeCount">+</text>
                </view>
              </view>
              <text class="point-remove" data-index="{{index}}" bindtap="removeSelectedTag">Ã—</text>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€æç¤º -->
        <view class="empty-state" wx:if="{{selectedTags.length === 0 && selectedTopics.length === 0}}">
          <text class="empty-text">
            {{homeworkType === 'topic-middle' ? 'è¯·é€‰æ‹©è¯­æ³•ä¸“é¢˜' : 'è¯·é€‰æ‹©è¯­æ³•å°ç‚¹'}}
          </text>
        </view>
      </view>
      
      <!-- ä¸­è€ƒé…æ¯”æ¨¡å¼æ˜¾ç¤ºå·²é€‰è¯­æ³•ç‚¹ -->
      <view class="gaokao-selected-points" wx:if="{{homeworkType === 'zhongkao'}}">
        <view class="gaokao-header">
          <view class="gaokao-header-top">
            <text class="gaokao-title">ä¸­è€ƒé…æ¯”å·²ç”Ÿæˆ</text>
            <view class="year-package-selector">
              <text class="year-label">å¹´ä»½å¥—é¤:</text>
              <view class="year-buttons">
                <text class="year-btn {{zhongkaoRatio.yearPackage === '2025' ? 'active' : ''}}" data-year="2025" bindtap="switchYearPackage">2025</text>
                <text class="year-btn {{zhongkaoRatio.yearPackage === '2024' ? 'active' : ''}}" data-year="2024" bindtap="switchYearPackage">2024</text>
                <text class="year-btn {{zhongkaoRatio.yearPackage === '2023' ? 'active' : ''}}" data-year="2023" bindtap="switchYearPackage">2023</text>
              </view>
            </view>
          </view>
          <text class="gaokao-subtitle">å…±{{zhongkaoRatio.selectedGrammarPoints.length}}ä¸ªè¯­æ³•ç‚¹ï¼ˆé€‰æ‹©{{zhongkaoRatio.choiceCount}}é¢˜+å¡«ç©º{{zhongkaoRatio.fillCount}}é¢˜ï¼‰</text>
          <button class="btn btn-small btn-white regenerate-btn" bindtap="regenerateZhongkaoCombo">â†» é‡é€‰ä¸€æ‰¹</button>
        </view>
        <view class="selected-points-grid">
          <view 
            class="selected-point-item"
            wx:for="{{zhongkaoRatio.selectedGrammarPoints}}" 
            wx:key="*this"
          >
            <text class="point-name">{{item}}</text>
            <text class="point-remove" data-point="{{item}}" bindtap="removeZhongkaoPoint">Ã—</text>
          </view>
        </view>
      </view>
    </view>

    
    <!-- ä¸“é¢˜æ¨¡å¼ï¼šä¸€çº§èœå•ä½œä¸ºåˆ†ç»„æ ‡ç­¾ï¼ŒäºŒçº§èœå•ä½œä¸ºé€‰æ‹©é¡¹ -->
    <view class="grammar-menu" wx:if="{{homeworkType === 'topic-middle' && grammarMenuData.length > 0}}">
      <view class="menu-group" wx:for="{{grammarMenuData}}" wx:key="id">
        <!-- ä¸€çº§èœå•ï¼šåˆ†ç»„æ ‡ç­¾ï¼ˆä¸å¯ç‚¹å‡»ï¼‰ -->
        <view class="group-label">
          <text class="group-name">{{item.name}}</text>
        </view>
        
        <!-- äºŒçº§èœå•ï¼šé€‰æ‹©é¡¹ -->
        <view class="level2-topics">
          <view 
            class="topic-item {{topic.selected ? 'selected' : ''}}"
            wx:for="{{item.children}}"
            wx:for-item="topic"
            wx:key="id"
            data-id="{{topic.id}}"
            bindtap="selectGrammarTopic"
          >
            <view class="topic-content">
              <view class="topic-header">
                <text class="topic-name">{{topic.name}}</text>
                <text class="topic-frequency" wx:if="{{topic.examFrequency}}">{{topic.examFrequency}}</text>
              </view>
              <view class="topic-meta">
                <text class="topic-years" wx:if="{{topic.examYears && topic.examYears.length > 0}}">{{topic.examYears.join('ã€')}}å¹´</text>
                <text class="topic-region" wx:if="{{topic.examRegion}}">{{topic.examRegion}}</text>
                <text class="topic-subcount" wx:if="{{topic.children}}">{{topic.children.length}}ä¸ªå­çŸ¥è¯†ç‚¹</text>
              </view>
              <!-- å­çŸ¥è¯†ç‚¹é¢„è§ˆ -->
              <view class="sub-points-preview" wx:if="{{topic.children && topic.children.length > 0}}">
                <text class="sub-points-label">å­çŸ¥è¯†ç‚¹ï¼š</text>
                <text class="sub-point-name" wx:for="{{topic.children}}" wx:for-item="subPoint" wx:key="id">{{subPoint.name}}</text>
              </view>
            </view>
            <view class="topic-checkbox {{topic.selected ? 'checked' : ''}}"></view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- è‡ªé€‰æ¨¡å¼ï¼šä¸€çº§èœå•ä½œä¸ºåˆ†ç»„æ ‡ç­¾ï¼Œä¸‰çº§èœå•ä½œä¸ºé€‰æ‹©é¡¹ -->
    <view class="grammar-menu" wx:if="{{homeworkType === 'custom-middle' && grammarMenuData.length > 0}}">
      <!-- ç­›é€‰æ  -->
      <view class="filter-bar">
        <view class="filter-group">
          <text class="filter-label">è€ƒé¢‘ï¼š</text>
          <text class="filter-btn {{selectedFrequency === null ? 'active' : ''}}" data-frequency="null" bindtap="filterByFrequency">å…¨éƒ¨</text>
          <text class="filter-btn {{selectedFrequency === 'high' ? 'active' : ''}}" data-frequency="high" bindtap="filterByFrequency">é«˜é¢‘</text>
          <text class="filter-btn {{selectedFrequency === 'medium' ? 'active' : ''}}" data-frequency="medium" bindtap="filterByFrequency">ä¸­é¢‘</text>
          <text class="filter-btn {{selectedFrequency === 'low' ? 'active' : ''}}" data-frequency="low" bindtap="filterByFrequency">ä½é¢‘</text>
        </view>
      </view>
      
      <view class="menu-group" wx:for="{{grammarMenuData}}" wx:key="id">
        <!-- ä¸€çº§èœå•ï¼šåˆ†ç»„æ ‡ç­¾ï¼ˆä¸å¯ç‚¹å‡»ï¼‰ -->
        <view class="group-label">
          <text class="group-name">{{item.name}}</text>
        </view>
        
        <!-- äºŒçº§èœå•ï¼šå¯æŠ˜å æ˜¾ç¤º -->
        <view class="level2-section" wx:for="{{item.children}}" wx:for-item="level2" wx:key="id">
          <view class="level2-header" bindtap="toggleLevel2" data-level2-id="{{level2.id}}">
            <text class="level2-name">{{level2.name}}</text>
            <view class="level2-actions">
              <text class="select-all-btn" catchtap="selectAllPoints" data-level2-id="{{level2.id}}">å…¨é€‰</text>
              <text class="expand-icon">{{level2.expanded ? 'â–¼' : 'â–¶'}}</text>
            </view>
          </view>
          
          <!-- ä¸‰çº§èœå•ï¼šé€‰æ‹©é¡¹ -->
          <view class="level3-points" wx:if="{{level2.expanded}}">
            <view 
              class="point-item {{point.selected ? 'selected' : ''}}"
              wx:for="{{level2.children}}"
              wx:for-item="point"
              wx:key="id"
              data-point-id="{{point.id}}"
              bindtap="selectPoint"
            >
              <view class="point-content">
                <view class="point-header">
                  <text class="point-name">{{point.name}}</text>
                  <text class="point-frequency" wx:if="{{point.examFrequency}}">{{point.examFrequency}}</text>
                </view>
                <view class="point-meta">
                  <text class="point-years" wx:if="{{point.examYears && point.examYears.length > 0}}">{{point.examYears.join('ã€')}}å¹´</text>
                  <text class="point-region" wx:if="{{point.examRegion}}">{{point.examRegion}}</text>
                </view>
              </view>
              <view class="point-checkbox {{point.selected ? 'checked' : ''}}"></view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‚¬æµ®é¢„è§ˆæŒ‰é’®ï¼ˆå°çƒæ ·å¼ï¼‰ -->
  <!-- ä¸“é¢˜æ¨¡å¼ï¼šé€‰æ‹©ä¸“é¢˜å’Œé¢˜å‹åæ˜¾ç¤º -->
  <view 
    class="floating-preview-btn show" 
    wx:if="{{homeworkType === 'topic-middle' && selectedTopics.length > 0}}"
    bindtap="goToPreview"
  >
    <view class="floating-btn-content">
      <text class="floating-btn-icon">ğŸ‘</text>
      <text class="floating-btn-text">é¢„è§ˆ</text>
    </view>
  </view>
  
  <!-- è‡ªé€‰æ¨¡å¼ï¼šé€‰æ‹©çŸ¥è¯†ç‚¹åæ˜¾ç¤º -->
  <view 
    class="floating-preview-btn show" 
    wx:if="{{homeworkType === 'custom-middle' && selectedTags.length > 0}}"
    bindtap="goToPreview"
  >
    <view class="floating-btn-content">
      <text class="floating-btn-icon">âœ“</text>
      <text class="floating-btn-text">æˆ‘é€‰å¥½äº†</text>
    </view>
  </view>
  
  <!-- ä¸­è€ƒé…æ¯”æ¨¡å¼ï¼šç”Ÿæˆé…æ¯”åæ˜¾ç¤º -->
  <view 
    class="floating-preview-btn show" 
    wx:if="{{homeworkType === 'zhongkao' && zhongkaoRatio.selectedGrammarPoints.length > 0}}"
    bindtap="goToPreview"
  >
    <view class="floating-btn-content">
      <text class="floating-btn-icon">ğŸ‘</text>
      <text class="floating-btn-text">é¢„è§ˆ</text>
    </view>
  </view>

</view>

