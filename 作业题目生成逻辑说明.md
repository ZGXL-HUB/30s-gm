# 作业题目生成逻辑说明

## 您的疑问是正确的！

### 📋 作业数据结构分析

**教师发布作业时保存的数据**（`generateHomeworkData`）:

```javascript
{
  _id: "homework_1760341214975",
  type: "gaokao",  // 作业类型
  title: "高考配比练习",
  selectedItems: [    // ⚠️ 只保存语法点名称和题目数量
    {
      category: "介词",
      name: "介词综合",
      questionCount: 1
    },
    {
      category: "代词",
      name: "反身代词",
      questionCount: 1
    },
    // ... 共10个语法点
  ],
  selectedGrammarPoints: [  // 语法点名称数组
    "介词综合", "反身代词", "连词与动词", ...
  ],
  totalQuestions: 10,
  // ❌ 注意：没有 questions 字段！没有保存实际题目！
}
```

### 🔍 题目生成流程

**发布作业时**:
1. 教师选择语法点（如"介词综合"）
2. 系统只保存语法点名称和题目数量
3. **不保存实际题目内容**

**学生做题时**:
1. 从云数据库或本地题库中
2. 根据语法点名称查询匹配的题目
3. 动态生成题目

**生成学案时**（当前问题所在）:
1. 读取作业的 `selectedItems`
2. 从题库中匹配语法点
3. 获取真实题目并生成学案

### ❗ 当前问题

**题库加载失败**:
```
选择题题库加载失败: can not find module : , require args is ../语法选择题题库/语法选择题题库.json
```

**原因**: 小程序环境不支持直接 `require` JSON 文件

**当前状态**:
- ✅ 填空题题库可以加载（JS模块）
- ❌ 选择题题库加载失败（JSON文件）
- ⚠️ 只能获取到4个填空题（因为语法点匹配有限）

### 🎯 题目来源分析

您看到的"部分真实题目"：

```
题目示例: {
  grammarPoint: "动词分词书写",
  question: "work的现在分词是______",
  hasOptions: true
}
```

**这些题目来自**:
- 📂 `miniprogram/writing_exercise_questions.js`（填空题题库）
- 📊 48个填空题，按表格组织
- 🔄 自动转换为选择题格式（正确答案作为A选项）

**不是来自**:
- ❌ 不是入户测试的选择题
- ❌ 不是语法选择题题库（因为加载失败）

### 📊 当前匹配结果

控制台显示：
```
selectedItems: Array(10)  // 10个语法点
✅ 从作业数据最终获取到 4 个题目  // 只匹配到4个
```

**为什么只有4题**？

因为作业的语法点（如"介词综合"、"反身代词"等）在填空题题库中匹配较少：

| 作业语法点 | 填空题题库 | 匹配结果 |
|-----------|----------|---------|
| 介词综合 | ❌ 无 | 0题 |
| 反身代词 | ❌ 无 | 0题 |
| 连词与动词 | ❌ 无 | 0题 |
| 不规则复数 | ✅ 名词变复数 | 有匹配 |
| 现在分词综合 | ✅ 现在分词书写 | 有匹配 |
| 过去分词综合 | ✅ 过去分词书写 | 有匹配 |
| ... | ... | ... |

### 🔧 解决方案

**方案1: 修复选择题题库加载**（推荐）
- 将JSON转换为JS模块格式
- 58个选择题可用
- 匹配成功率高

**方案2: 扩展填空题题库**
- 添加更多语法点的填空题
- 需要大量题目创作工作

**方案3: 混合使用**
- 选择题题库（主要）+ 填空题题库（补充）
- 最大化题目覆盖率

### 📝 题库对比

| 题库 | 题目数量 | 格式 | 语法点覆盖 | 加载状态 |
|-----|---------|------|----------|---------|
| 选择题题库 | 58题 | 完整选择题 | 60个语法点 | ❌ 失败 |
| 填空题题库 | 48题 | 填空题 | 16个表格 | ✅ 成功 |

### 🎯 下一步行动

1. **修复选择题题库加载**（最重要）
2. **改进语法点匹配算法**（已完成）
3. **验证题目内容和质量**

---

**结论**: 您的理解完全正确！系统确实只保存语法点名称，题目是在使用时动态匹配的。当前的问题是选择题题库加载失败，导致只能使用填空题，而填空题与作业的语法点匹配度较低，所以只获取到4题。
