# 专属组合完整流程测试

## 测试目标
验证专属组合从设置到生成的完整流程是否正常工作。

## 测试步骤

### 第一步：设置专属组合
1. 进入语法点选择页面
2. 点击"综合"大类
3. 点击"我的专属组合"按钮
4. 选择"进入设置"
5. 在设置页面进行以下配置：
   - 介词：2题
   - 代词：1题
   - 非谓语：3题
   - 形容词：1题
6. 点击"保存专属组合"

### 第二步：验证配置保存
1. 检查控制台日志，确认：
   - 配置正确构建
   - 事件正确发送
   - 页面正确返回

### 第三步：验证状态更新
1. 返回主页面后，检查：
   - "我的专属组合"按钮是否变为蓝色
   - 控制台是否显示配置加载成功

### 第四步：生成专属组合题目
1. 点击变色的"我的专属组合"按钮
2. 选择"按设置生成"
3. 检查生成的题目

## 预期结果

### 控制台日志验证
```
// 设置页面保存时
开始保存专属组合，配置: {介词: 2, 代词: 1, 非谓语: 3, 形容词: 1}
总题数: 7
构建的配置对象: {介词: 2, 代词: 1, 非谓语: {现在分词综合: 1, 过去分词综合: 1, 不定式综合: 1}, 形容词: 1}
配置已保存到本地存储
已发送customComboSet事件，配置: {...}
返回上一页成功

// 主页面接收配置时
开始保存自定义组合配置: {...}
配置已保存到存储: {isSet: true, config: {...}}
页面状态已更新
开始加载自定义组合配置
从存储中读取的配置: {isSet: true, config: {...}}
配置存在且已设置，更新状态
状态更新完成，isCustomComboSet: true
配置内容: {...}

// 生成题目时
开始生成自定义组合题目
当前配置: {介词: 2, 代词: 1, 非谓语: {...}, 形容词: 1}
配置状态: true
开始根据配置生成题目...
处理类别: 介词, 配置: 2
介词的子点列表: ["固定搭配", "介词+名词/动名词"]
为介词选择了: 固定搭配, 题数: 2
处理类别: 代词, 配置: 1
代词的子点列表: ["人称代词", "物主代词", "关系代词", "it相关"]
为代词选择了: 人称代词, 题数: 1
处理类别: 非谓语, 配置: {现在分词综合: 1, 过去分词综合: 1, 不定式综合: 1}
非谓语是复杂配置: {现在分词综合: 1, 过去分词综合: 1, 不定式综合: 1}
为非谓语的子点现在分词综合设置题数: 1
为非谓语的子点过去分词综合设置题数: 1
为非谓语的子点不定式综合设置题数: 1
处理类别: 形容词, 配置: 1
形容词的子点列表: ["找形容词词缀", "填写比较级和最高级(表格)", "比较级", "最高级"]
为形容词选择了: 比较级, 题数: 1
生成的题目配置: {固定搭配: 2, 人称代词: 1, 现在分词综合: 1, 过去分词综合: 1, 不定式综合: 1, 比较级: 1}
总题数: 7
```

### 界面验证
1. 按钮状态：从灰色变为蓝色
2. 题目生成：显示7题（2+1+3+1）
3. 标签显示：显示"我的专属组合（7题）"
4. 成功提示：显示"✅ 专属组合已生成7题"

## 问题排查

### 如果按钮不变色
1. 检查`saveCustomComboConfig`是否被调用
2. 检查`setData`是否正确执行
3. 检查`isCustomComboSet`状态是否正确

### 如果点击按钮无反应
1. 检查`handleCustomCombo`函数是否被调用
2. 检查`isCustomComboSet`状态是否为true
3. 检查弹窗是否正确显示

### 如果生成题目失败
1. 检查`generateCustomCombo`函数是否被调用
2. 检查`customComboConfig`是否存在
3. 检查配置格式是否正确

### 如果生成的题目数量不对
1. 检查配置解析逻辑
2. 检查子点选择逻辑
3. 检查题数计算逻辑

## 调试命令

### 手动测试配置
```javascript
// 在控制台执行以下命令测试配置
const testConfig = {
  isSet: true,
  config: {
    介词: 2,
    代词: 1,
    非谓语: {
      现在分词综合: 1,
      过去分词综合: 1,
      不定式综合: 1
    },
    形容词: 1
  }
};

wx.setStorageSync('customCombo', testConfig);
console.log('测试配置已保存');
```

### 检查存储状态
```javascript
// 检查存储中的配置
const config = wx.getStorageSync('customCombo');
console.log('存储中的配置:', config);
```

### 手动触发生成
```javascript
// 手动触发生成函数（需要在页面上下文中执行）
this.generateCustomCombo();
```

## 常见问题及解决方案

### 问题1：事件通信失败
**症状**：设置页面保存后，主页面按钮不变色
**解决方案**：
1. 检查`eventChannel`是否存在
2. 确保事件名称正确
3. 添加备用存储机制

### 问题2：配置格式错误
**症状**：生成题目时配置解析失败
**解决方案**：
1. 检查配置对象结构
2. 确保数据类型正确
3. 添加配置验证

### 问题3：子点选择失败
**症状**：某些类别无法生成题目
**解决方案**：
1. 检查`getSubPointsByCategory`函数
2. 验证`isPointExists`函数
3. 添加默认子点处理

## 性能优化建议

1. **减少不必要的setData调用**
2. **优化配置加载时机**
3. **添加配置缓存机制**
4. **优化事件通信效率**

## 测试完成标准

- [ ] 设置页面正常保存配置
- [ ] 主页面正确接收配置
- [ ] 按钮状态正确更新
- [ ] 生成题目功能正常
- [ ] 题目数量符合配置
- [ ] 控制台日志完整
- [ ] 用户提示信息准确 