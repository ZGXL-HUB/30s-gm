# 代码质量优化说明

针对微信开发者工具「代码质量」报告的修改与建议。

## 已完成的修改

### 1. 主包未使用的 JS 文件：`utils/markdown.js`（已通过）

- **问题**：主包内存在主包未使用的 JS 文件 `utils/markdown.js`。
- **原因**：该文件仅被**教师分包**（`pages/teacher`）下的页面引用，主包页面未使用，但文件放在主包 `utils/` 下会被算作主包体积。
- **处理**：
  - 已将 `markdown.js` 移至教师分包：`miniprogram/pages/teacher/utils/markdown.js`。
  - 教师分包内页面引用改为：`require('../../utils/markdown.js')`。
  - 已删除主包中的 `miniprogram/utils/markdown.js`。
  - 根目录下的 `pages/teacher-materials/index.js`（若仍在使用）已改为引用本页下的 `./utils/markdown.js` 副本，避免报错。
- **结果**：重新扫描后「主包未使用的 JS 文件」应显示为已通过。

---

## 建议你自行优化的项

### 2. 主包大小（主包应 &lt; 1.5 M）

- 已通过移除主包中的 `markdown.js` 略减主包体积。
- **本次优化（2026/02）：**
  - **删除主包重复数据**：主包中的 `config/middle-school-grammar-data.js` 仅教师分包使用，教师分包内已有副本 `pages/teacher/config/middle-school-grammar-data.js`，已删除主包该文件（约 30KB）。
  - **直播列表迁入 live 分包**：将 `pages/live-course-list` 迁入 live 分包为 `pages/live/course-list`，入口改为 `/pages/live/course-list/index`（主入口、activity-index、translation 的跳转已更新），减少主包页面与资源。
  - **修复「主包未使用 JS：utils/liveService.js」**：因只有 live 分包使用，已将 `utils/liveService.js` 与 `config/liveActivityConfig.js` 迁入 live 分包（`pages/live/utils/liveService.js`、`pages/live/config/liveActivityConfig.js`），主包中已删除这两项；live 分包内所有页面已改为 `require('../../utils/liveService.js')`。
- 若仍超 1.5 M，可继续：
  - **分包**：详见 **《主包可迁到分包清单与步骤》**（`docs/主包可迁到分包清单与步骤.md`），含可迁页面清单与具体修改步骤。
  - **按需加载**：确认 `app.json` 中已使用 `"lazyCodeLoading": "requiredComponents"`（你当前已开启）。
  - **清理未用代码**：删除未在 `app.json` 中注册且不再使用的页面/组件。
  - **云开发/CDN**：大一点的静态资源（如图片、音频）改为云存储或 CDN 链接，用 `wx.cloud` 或 URL 加载。

### 3. 图片和音频资源（建议单包内 &lt; 200 K）

- **音频**：`miniprogram/sounds/` 下的 `tap.mp3`、`toast.mp3` 若总大小超过 200KB，建议：
  - 用音频工具压缩（如 FFmpeg、在线压缩站），缩短时长或降低码率。
  - 或上传到云存储/CDN，运行时通过 URL 播放（需在 `utils/sound.js` 中改为使用网络地址）。
- **图片**：主包及分包中用到的图片（如 `images/icons/`、示例图等）建议：
  - 使用 TinyPNG 等工具压缩。
  - TabBar 等必要图标尽量控制数量与尺寸；非首屏大图可放云存储或分包内并控制单包总量。
- **目标**：每个代码包（主包或分包）内的「图片 + 音频」总大小尽量控制在 200KB 以内。

---

## 操作后建议

1. 在微信开发者工具中点击「代码质量」的 **重新扫描**，确认「主包未使用的 JS」已通过。
2. 若主包仍超 1.5 M，按上面「主包大小」建议继续减体积。
3. 若「图片和音频资源」仍未通过，按上面压缩或迁移到云存储/CDN 后再次扫描。
