# 主包「可迁到分包」页面清单与修改步骤

用于解决代码质量中「主包大小应 &lt; 1.5 M」未通过的问题。以下页面**非 tabBar、非启动页**，可按需迁到分包以减小主包体积。

---

## 一、必须保留在主包的页面（不可迁）

| 路径 | 说明 |
|------|------|
| `pages/main/index` | 启动页（`app.json` 的 `pages[0]`） |
| `pages/index/index` | tabBar 首页 |
| `pages/grammar-writing/index` | tabBar 书写练习 |
| `pages/user-center/index` | tabBar 我的 |

---

## 二、可迁到分包的页面清单（按功能分组）

### 1. 语法选择与练习流程（建议迁到新分包 `practice`）

| 当前主包路径 | 说明 |
|-------------|------|
| `pages/grammar-select/index` | 语法选择 |
| `pages/grammar-overview/index` | 语法概览 |
| `pages/level-select/index` | 等级选择 |
| `pages/exercise-page/index` | 练习页 |
| `pages/mistakes-page/index` | 错题页 |
| `pages/custom-combo-setting/index` | 专属组合设置 |
| `pages/special-practice/index` | 专项练习 |

### 2. 规则说明页（建议迁到 `practice` 或独立分包 `rules`）

| 当前主包路径 | 说明 |
|-------------|------|
| `pages/noun-rules/index` | 名词规则 |
| `pages/present-participle-rules/index` | 现在分词规则 |
| `pages/past-participle-rules/index` | 过去分词规则 |
| `pages/tense-writing-rules/index` | 时态书写规则 |
| `pages/tense-signal-rules/index` | 时态标志词规则 |
| `pages/tense-signal-cards/index` | 时态标志词卡片 |
| `pages/voice-rules/index` | 语态规则 |
| `pages/voice-flip-cards/index` | 语态翻卡 |
| `pages/adjective-prefix-suffix-rules/index` | 形容词前后缀规则 |
| `pages/comparison-writing-rules/index` | 比较级书写规则 |
| `pages/adverb-writing-rules/index` | 副词书写规则 |

### 3. 记录与商品示例（建议迁到 `practice` 或独立分包）

| 当前主包路径 | 说明 |
|-------------|------|
| `pages/sumRecord/index` | 汇总记录 |
| `pages/sumRecordResult/index` | 汇总结果 |
| `pages/updateRecord/index` | 更新记录 |
| `pages/updateRecordResult/index` | 更新结果 |
| `pages/updateRecordSuccess/index` | 更新成功 |
| `pages/goods-list/index` | 商品列表 |
| `pages/business/index` | 业务页 |
| `pages/examples/index` | 示例列表 |
| `pages/exampleDetail/index` | 示例详情 |

### 4. 能力测试与测验（建议迁到 `practice`）

| 当前主包路径 | 说明 |
|-------------|------|
| `pages/ability-test/grammar-test` | 语法测试 |
| `pages/ability-test/writing-test` | 书写测试 |
| `pages/ability-test/simple-writing-test` | 简单书写测试 |
| `pages/ability-test/comprehensive-writing-test` | 综合书写测试 |
| `pages/ability-test/ability-map` | 能力图谱 |
| `pages/level-test/index` | 等级测试 |
| `pages/grammar-test/grammar-test` | 语法测验 |
| `pages/grammar-test-sets/index` | 语法题集列表 |
| `pages/grammar-test-sets/test` | 语法题集测验 |

### 5. 反馈与管理（建议迁到独立分包 `other` 或并入 `practice`）

| 当前主包路径 | 说明 |
|-------------|------|
| `pages/feedback/index` | 反馈页 |
| `pages/feedback/history` | 反馈历史 |
| `pages/admin/feedback-management` | 管理端反馈管理 |
| `pages/test-cloud/index` | 云测试 |
| `pages/student-join-class/index` | 学生加入班级 |
| `pages/test-mapping-verification/index` | 测试映射校验 |

---

## 三、推荐分包方案与修改步骤

### 方案 A：新增一个「练习」分包 `practice`（推荐）

将「语法选择与练习流程 + 规则说明页 + 记录/示例 + 能力测试 + 反馈管理」全部迁到 `pages/practice/` 下，主包只保留：启动页 + 3 个 tabBar 页。

**步骤概要：**

1. **新建分包目录与页面**
   - 在 `miniprogram` 下新建 `pages/practice/`。
   - 把上表所列主包页面**整目录**复制到 `pages/practice/` 下（保持子路径一致，如 `grammar-select`、`ability-test/grammar-test` 等）。

2. **修改 `app.json`**
   - 在 `pages` 数组中**删除**已迁走页面的路径。
   - 在 `subPackages` 中新增一项：
   ```json
   {
     "root": "pages/practice",
     "name": "practice",
     "pages": [
       "grammar-select/index",
       "grammar-overview/index",
       "level-select/index",
       "exercise-page/index",
       "mistakes-page/index",
       "custom-combo-setting/index",
       "special-practice/index",
       "noun-rules/index",
       "present-participle-rules/index",
       "past-participle-rules/index",
       "tense-writing-rules/index",
       "tense-signal-rules/index",
       "tense-signal-cards/index",
       "voice-rules/index",
       "voice-flip-cards/index",
       "adjective-prefix-suffix-rules/index",
       "comparison-writing-rules/index",
       "adverb-writing-rules/index",
       "sumRecord/index",
       "sumRecordResult/index",
       "updateRecord/index",
       "updateRecordResult/index",
       "updateRecordSuccess/index",
       "goods-list/index",
       "business/index",
       "examples/index",
       "exampleDetail/index",
       "ability-test/grammar-test",
       "ability-test/writing-test",
       "ability-test/simple-writing-test",
       "ability-test/comprehensive-writing-test",
       "ability-test/ability-map",
       "level-test/index",
       "grammar-test/grammar-test",
       "grammar-test-sets/index",
       "grammar-test-sets/test",
       "feedback/index",
       "feedback/history",
       "admin/feedback-management",
       "test-cloud/index",
       "student-join-class/index",
       "test-mapping-verification/index"
     ]
   }
   ```

3. **全局替换跳转路径**
   - 所有 `wx.navigateTo` / `wx.redirectTo` / `wx.reLaunch` 中，原主包路径改为分包路径。
   - 例如：`/pages/grammar-select/index` → `/pages/practice/grammar-select/index`，`/pages/exercise-page/index` → `/pages/practice/exercise-page/index`。
   - 建议在项目中全局搜索上述主包路径（如 `pages/grammar-select`、`pages/exercise-page` 等），逐处替换。

4. **修正分包内 JS 的 require 路径**
   - 原主包页面若通过 `require('../../utils/xxx.js')` 等方式引用主包 `utils`、`config` 等，迁到 `pages/practice/` 后，相对路径会变。
   - 例如从 `pages/practice/grammar-select/index.js` 引用主包工具：`require('../../../utils/xxx.js')`。
   - 若有引用 `config`、`data` 等，同样按相对位置改为 `../../../config/`、`../../../data/` 等。

5. **删除主包中的原页面目录**
   - 确认分包页面和跳转都正常后，删除主包下已迁移的页面目录（如 `pages/grammar-select`、`pages/exercise-page` 等），避免重复与主包体积仍被计入。

6. **重新编译并扫描**
   - 在微信开发者工具中重新编译，在「代码质量」中点击「重新扫描」，确认主包大小与「主包未使用的 JS」是否通过。

---

### 方案 B：仅迁部分「大块」页面

若不想一次性全迁，可先迁体积或引用较多的页面，例如：

- 先迁：`exercise-page`、`grammar-select`、`level-select`、`ability-test/*`、`grammar-test-sets/*` 以及所有 `*-rules/*` 规则页。
- 再迁：`sumRecord*`、`updateRecord*`、`feedback/*`、`admin/*`、`examples`、`exampleDetail` 等。

操作步骤与方案 A 相同，只是新建的 `pages/practice/` 下只放这批页面，并在 `app.json` 的 `practice` 分包 `pages` 里只登记这些页面。

---

## 四、本次已完成的修复（避免「主包未使用 JS」）

- **`utils/liveService.js` 报主包未使用**  
  - 原因：直播列表迁到 live 分包后，只有 live 分包在用该文件，主包被判定为未使用。  
  - 处理：已将 `liveService.js` 与 `config/liveActivityConfig.js` 迁到 **live 分包**：
    - `pages/live/config/liveActivityConfig.js`
    - `pages/live/utils/liveService.js`（内引用主包 `utils/cloudDataLoader.js` 与 `data/liveLesson1Exercises.js` 的路径已改为 `../../../utils/...`、`../../../data/...`）
  - 主包中已删除 `utils/liveService.js` 和 `config/liveActivityConfig.js`。
  - live 分包内所有页面已改为：`require('../../utils/liveService.js')`。

按上述步骤迁移后，主包体积会明显下降；若仍超 1.5 M，可再配合压缩图片/音频或把静态资源放到云存储/CDN。
